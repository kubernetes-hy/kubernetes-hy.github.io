{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-5/2-custom-resource-definitions","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Learning Objectives"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After this section, you can"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Create your own Custom Resource Definitions"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Custom Resource Definitions"}]},{"type":"text","value":" (CRDs) are a way to extend Kubernetes with our own Resources. We've used a large number of them already, e.g. in "},{"type":"element","tagName":"a","properties":{"href":"/part-4/3-gitops"},"children":[{"type":"text","value":"part 4"}]},{"type":"text","value":" we used "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Application"}]},{"type":"text","value":" with ArgoCD."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"They're so integral part of using Kubernetes that it's a good idea to learn how to make one ourselves."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before we can get started we need to figure out what we want to create. So let's create a resource that can be used to create countdowns. The resource will be called \"Countdown\". It will have some "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"length"}]},{"type":"text","value":" and some "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"delay"}]},{"type":"text","value":" between executions. The execution - what happens each time the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"delay"}]},{"type":"text","value":" has elapsed - is left up to an image. So that someone using our CRD can create a countdown that e.g. posts a message to Twitter each time has ticked down."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As a template I'll use one provided by the "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"docs"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"resourcedefinition.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apiextensions.k8s.io/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" CustomResourceDefinition\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# name must match the spec fields below, and be in the form: <plural>.<group>"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdowns.stable.dwk\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# group name to use for REST API: /apis/<group>/<version>"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"group"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" stable.dwk\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# either Namespaced or Cluster"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"scope"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Namespaced\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"names"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# kind is normally the CamelCased singular type. Your resource manifests use this."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Countdown\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# plural name to be used in the URL: /apis/<group>/<version>/<plural>"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"plural"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdowns\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# singular name to be used as an alias on the CLI and for display"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"singular"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# shortNames allow shorter string to match your resource on the CLI"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"shortNames"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" cd\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# list of versions supported by this CustomResourceDefinition"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"versions"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Each version can be enabled/disabled by Served flag."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"served"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# One and only one version must be marked as the storage version."}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"storage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"schema"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"openAPIV3Schema"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" object\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"properties"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" object\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"properties"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"length"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" integer\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"delay"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" integer\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" string\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"additionalPrinterColumns"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Length\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" integer\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"description"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" The length of the countdown\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jsonPath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" .spec.length\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Delay\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" integer\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"description"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" The length of time (ms) between executions\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jsonPath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" .spec.delay"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can create our own Countdown:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"countdown.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" stable.dwk/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Countdown\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" doomsday\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"length"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"20"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"delay"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1200"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" jakousa/dwk"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app10"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"sha"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"84d581d"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And then:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl apply -f countdown.yaml\n  countdown.stable.dwk/doomsday created\n\n$ kubectl get cd\n  NAME        LENGTH   DELAY\n  doomsday    20       1200"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we have a new resource. Next, let's create a new "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#custom-controllers","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"custom controller"}]},{"type":"text","value":" that'll start a pod that runs a container from the image and makes sure countdowns are destroyed. This will require some coding."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For the implementation, I decided to use a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/job/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Job"}]},{"type":"text","value":", a resource familiar to us from "},{"type":"element","tagName":"a","properties":{"href":"part-2/4-statefulsets-and-jobs#jobs-and-cronjobs"},"children":[{"type":"text","value":"part 2"}]},{"type":"text","value":".\nPods created by Jobs are intended to run once until completion. However, neither the completed Jobs nor the Pods are removed automatically. Those are preserved so that the execution logs can be reviewed after job execution."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Our controller has to do 3 things:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Create a Job from a Countdown"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Reschedule Jobs until the number of executions defined in Countdown (the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"length"}]},{"type":"text","value":") has been completed."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Clean all Jobs and Pods after the execution"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To implement the controller we need to do some low-level stuff and access the Kuberneter directly using the REST APIs."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By listening to the Kubernetes API at "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/apis/stable.dwk/v1/countdowns?watch=true"}]},{"type":"text","value":" we will receive an ADDED for every Countdown object in the cluster. Then creating a job can be done by parsing the data from the message and POSTing a valid payload to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/apis/batch/v1/namespaces/<namespace>/jobs"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For jobs, we'll listen to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/apis/batch/v1/jobs?watch=true"}]},{"type":"text","value":" and wait for MODIFIED event where the success state is set to true and update the labels for the jobs to store the status. To delete a Job and its Pod we can send a delete request to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/api/v1/namespaces/<namespace>/pods/<pod_name>"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/apis/batch/v1/namespaces/<namespace>/jobs/<job_name>"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And finally, we can remove the countdown with a delete request to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/apis/stable.dwk/v1/namespaces/<namespace>/countdowns/<countdown_name>"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A version of this controller can be found "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app10","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":". It has a readily built image "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"jakousa/dwk-app10-controller:sha-4256579"}]},{"type":"text","value":". We cannot just deploy it as it won't have access to the APIs. For this, we will need to define suitable access."}]},{"type":"element","tagName":"h2","properties":{"id":"rbac","style":"position:relative;"},"children":[{"type":"text","value":"RBAC"},{"type":"element","tagName":"a","properties":{"href":"#rbac","ariaLabel":"rbac permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"RBAC (Role-based access control) is an authorization method that allows us to define access for individual users, service accounts or groups by giving them roles. For our use case, we will define a ServiceAccount resource."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"serviceaccount.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ServiceAccount\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"account"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"and then specify the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"serviceAccountName"}]},{"type":"text","value":" for the deployment"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"deployment.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serviceAccountName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"account\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" jakousa/dwk"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app10"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"sha"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"4256579"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next is defining the role and its rules. There are two types of roles: "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ClusterRole"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Role"}]},{"type":"text","value":". Roles are namespace-specific whereas ClusterRoles can access all of the namespaces - in our case, the controller will access all countdowns in all namespaces so a ClusterRole will be required."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The rules are defined with the apiGroup, resource and verbs. For example, the jobs was "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/apis/batch/v1/jobs?watch=true"}]},{"type":"text","value":" so it's in the apiGroup \"batch\" and resource \"jobs\" and the verbs see "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":". Core API group is an empty string \"\" like in the case of pods."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"clusterrole.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ClusterRole\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" rbac.authorization.k8s.io/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"role\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"rules"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiGroups"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# at the HTTP level, the name of the resource for accessing Pod"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# objects is \"pods\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"pods\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"verbs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"get\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"list\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"delete\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiGroups"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"batch\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# at the HTTP level, the name of the resource for accessing Job"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# objects is \"jobs\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"jobs\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"verbs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"get\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"list\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"watch\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"create\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"delete\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiGroups"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"stable.dwk\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"countdowns\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"verbs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"get\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"list\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"watch\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"create\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"delete\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And finally bind the ServiceAccount and the role. There are two types of bindings as well: "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ClusterRoleBinding"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"RoleBinding"}]},{"type":"text","value":". If we used a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"RoleBinding"}]},{"type":"text","value":" with a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ClusterRole"}]},{"type":"text","value":" we would be able to restrict access to a single namespace. For example, if permission to access secrets is defined to a ClusterRole and we gave it via "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"RoleBinding"}]},{"type":"text","value":" to a namespace called \"test\", they would only be able to access secrets in the namespace \"test\" - even though the role is a \"ClusterRole\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In our case "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ClusterRoleBinding"}]},{"type":"text","value":" is required since we want the controller to access all of the namespaces from the namespace it's deployed in, in this case, namespace \"default\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"clusterrolebinding.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" rbac.authorization.k8s.io/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ClusterRoleBinding\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"rolebinding\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"roleRef"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiGroup"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" rbac.authorization.k8s.io\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ClusterRole\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"role\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"subjects"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ServiceAccount\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" countdown"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"account\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" default"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After deploying all of that we can check logs after applying a countdown. (You may have to delete the pod to have it restart in case it didn't have access and it got stuck)"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl logs countdown-controller-dep-7ff598ffbf-q2rp5\n  > app10@1.0.0 start /usr/src/app\n  > node index.js\n\n  Scheduling new job number 20 for countdown doomsday to namespace default\n  Scheduling new job number 19 for countdown doomsday to namespace default\n  ...\n  Countdown ended. Removing countdown.\n  Doing cleanup"}]}]}]},{"type":"element","tagName":"text-box","properties":{"name":"Choosing language for CRDs","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  The countdown example controller is implemented in two ways: using "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app10-go","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Go"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app10","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"JavaScript"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  The best option is perhaps "},{"type":"element","tagName":"a","properties":{"href":"https://go.dev/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Go"}]},{"type":"text","value":" but this may not be the best place to learn a new language. The "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app10-go","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"app10-go"}]},{"type":"text","value":" README has info on what to do to get started with own CRD in Go!"}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 5.01: DIY CRD & Controller"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  This exercise doesn't rely on previous exercises. You may again choose whichever technologies you want for the implementation."}]},{"type":"text","value":"  "},{"type":"element","tagName":"p","properties":{"style":"color:firebrick;"},"children":[{"type":"text","value":"This exercise is difficult!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  We need a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"DummySite"}]},{"type":"text","value":" resource that can be used to create an HTML page from any URL."}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Create a \"DummySite\" resource that has a string property called \"website_url\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Create a controller that receives a created \"DummySite\" object from the API"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Have the controller create all of the resources that are required for the functionality."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  Refer to "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/kubernetes-api/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/reference/kubernetes-api/"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/using-api/api-concepts/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/reference/using-api/api-concepts/"}]},{"type":"text","value":" for more information on Kubernetes API, and\n"},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/using-api/client-libraries/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/reference/using-api/client-libraries/"}]},{"type":"text","value":" for information about client libraries."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You may also take inspiration from the material example apps: "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app10","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"js"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app10-go","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"go"}]},{"type":"text","value":". Note that the JavaScript app does not quite utilize the features of "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-client/javascript","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Kubernetes Client"}]},{"type":"text","value":", but it calls the REST API directly."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Test that creating a DummySite resource with website_url \""},{"type":"element","tagName":"a","properties":{"href":"https://example.com/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://example.com/"}]},{"type":"text","value":"\"\ncreates a copy of the website. With a more complex website your \"copy\" does not need to be a complete one. Eg. in "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Kubernetes","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://en.wikipedia.org/wiki/Kubernetes"}]},{"type":"text","value":" the CSS styles can be broken:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/609f88728f7f5dea2774c347ef555dde/b8bf8/wikipedia.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 64.34782608695653%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAACF0lEQVQoz41Py4rUQBTND/kN4k5w7Uq/xIUgIvRiwI0oLl2IuBIEdZCxQVFQYWZ6ksqrU0klqVSSzrOSSlWn8+i2GHAhiM7hcrhVl3POvYoQXd8LIbZFQau6zfIWRwWOsk3WNO22ZTvWDazbtWxkbMyKHW8iwZJ0k9dVoWhaqKpY0/rzVWMYBQC5rm8MQwAtsizkOERVhapOmkoBaFzYIZ+QOAmCIMtzBePK90vPK3w/whiHYQQhiWQ4lo20E5bFAeCWVSPUdh1rmobzjnPOGFOiKAxDFEUBIUT6EZLY9qiqhzBsKeVFceB8u91SxhohOKVUiiVLpWQFIRQEYRD40oIQmSyfrvxx3dayRs8TjiNsu4/j0nHqOCZJkuBLTNOk2LYBoQ1hoOvENEPbJpYlCzsOvLgIVitsGAiAAELXNC3btgEAum4AcIFQpECY+EHmoRLola7XQC80rTTNynXT31tgzws8z03TVMbK6+I4xpg3Ta8YRuYj6rlDmQ+0mmk9bTZjmg6yqorWdS3PlFSWpdxzf4l5nvte8kHxfbh20Y9TWlCxm4du203jcLgalN24f7LMHr0LF8f+3Qfo+p03qrmWg2ma93/ib+JherFcPz4OFyfZ7fv42q2fp2YuB/O8/3/yMAzLV89OXj798vHD0eLoxs17hpteVTxN4/n3z2dfP63Pvi3fv339/CF2QU3bLMu6rvu3+BewTcHEZ9bu9QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/609f88728f7f5dea2774c347ef555dde/a0b58/wikipedia.webp 230w","/static/609f88728f7f5dea2774c347ef555dde/bc10c/wikipedia.webp 460w","/static/609f88728f7f5dea2774c347ef555dde/966d8/wikipedia.webp 920w","/static/609f88728f7f5dea2774c347ef555dde/445df/wikipedia.webp 1380w","/static/609f88728f7f5dea2774c347ef555dde/eaa3b/wikipedia.webp 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/609f88728f7f5dea2774c347ef555dde/81c8e/wikipedia.png 230w","/static/609f88728f7f5dea2774c347ef555dde/08a84/wikipedia.png 460w","/static/609f88728f7f5dea2774c347ef555dde/c0255/wikipedia.png 920w","/static/609f88728f7f5dea2774c347ef555dde/b1001/wikipedia.png 1380w","/static/609f88728f7f5dea2774c347ef555dde/b8bf8/wikipedia.png 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/609f88728f7f5dea2774c347ef555dde/c0255/wikipedia.png","alt":"wikipedia","title":"wikipedia","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":" The controller doesn't have to work perfectly in all circumstances. The following workflow should succeed:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"apply role, account and binding."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"apply deployment."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"apply DummySite"}]},{"type":"text","value":"\n"}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Learning Objectives'><p>After this section, you can</p><ul>\n<li>Create your own Custom Resource Definitions</li>\n</ul></text-box><p><a href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/\" target=\"_blank\" rel=\"noopener noreferrer\">Custom Resource Definitions</a> (CRDs) are a way to extend Kubernetes with our own Resources. We've used a large number of them already, e.g. in <a href=\"/part-4/3-gitops\">part 4</a> we used <a href=\"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications\" target=\"_blank\" rel=\"noopener noreferrer\">Application</a> with ArgoCD.</p><p>They're so integral part of using Kubernetes that it's a good idea to learn how to make one ourselves.</p><p>Before we can get started we need to figure out what we want to create. So let's create a resource that can be used to create countdowns. The resource will be called \"Countdown\". It will have some <em>length</em> and some <em>delay</em> between executions. The execution - what happens each time the <em>delay</em> has elapsed - is left up to an image. So that someone using our CRD can create a countdown that e.g. posts a message to Twitter each time has ticked down.</p><p>As a template I'll use one provided by the <a href=\"https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/\" target=\"_blank\" rel=\"noopener noreferrer\">docs</a>.</p><p><strong>resourcedefinition.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apiextensions.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> CustomResourceDefinition\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># name must match the spec fields below, and be in the form: &lt;plural>.&lt;group></span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdowns.stable.dwk\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># group name to use for REST API: /apis/&lt;group>/&lt;version></span>\n  <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> stable.dwk\n  <span class=\"token comment\"># either Namespaced or Cluster</span>\n  <span class=\"token key atrule\">scope</span><span class=\"token punctuation\">:</span> Namespaced\n  <span class=\"token key atrule\">names</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># kind is normally the CamelCased singular type. Your resource manifests use this.</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Countdown\n    <span class=\"token comment\"># plural name to be used in the URL: /apis/&lt;group>/&lt;version>/&lt;plural></span>\n    <span class=\"token key atrule\">plural</span><span class=\"token punctuation\">:</span> countdowns\n    <span class=\"token comment\"># singular name to be used as an alias on the CLI and for display</span>\n    <span class=\"token key atrule\">singular</span><span class=\"token punctuation\">:</span> countdown\n    <span class=\"token comment\"># shortNames allow shorter string to match your resource on the CLI</span>\n    <span class=\"token key atrule\">shortNames</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> cd\n  <span class=\"token comment\"># list of versions supported by this CustomResourceDefinition</span>\n  <span class=\"token key atrule\">versions</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> v1\n      <span class=\"token comment\"># Each version can be enabled/disabled by Served flag.</span>\n      <span class=\"token key atrule\">served</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token comment\"># One and only one version must be marked as the storage version.</span>\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">schema</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">openAPIV3Schema</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object\n          <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object\n              <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">length</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer\n                <span class=\"token key atrule\">delay</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer\n                <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n      <span class=\"token key atrule\">additionalPrinterColumns</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Length\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The length of the countdown\n          <span class=\"token key atrule\">jsonPath</span><span class=\"token punctuation\">:</span> .spec.length\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Delay\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> integer\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The length of time (ms) between executions\n          <span class=\"token key atrule\">jsonPath</span><span class=\"token punctuation\">:</span> .spec.delay</code></pre></div><p>Now we can create our own Countdown:</p><p><strong>countdown.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> stable.dwk/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Countdown\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> doomsday\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">length</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n  <span class=\"token key atrule\">delay</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1200</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jakousa/dwk<span class=\"token punctuation\">-</span>app10<span class=\"token punctuation\">:</span>sha<span class=\"token punctuation\">-</span>84d581d</code></pre></div><p>And then:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl apply -f countdown.yaml\n  countdown.stable.dwk/doomsday created\n\n$ kubectl get cd\n  NAME        LENGTH   DELAY\n  doomsday    20       1200</code></pre></div><p>Now we have a new resource. Next, let's create a new <a href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#custom-controllers\" target=\"_blank\" rel=\"noopener noreferrer\">custom controller</a> that'll start a pod that runs a container from the image and makes sure countdowns are destroyed. This will require some coding.</p><p>For the implementation, I decided to use a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/job/\" target=\"_blank\" rel=\"noopener noreferrer\">Job</a>, a resource familiar to us from <a href=\"part-2/4-statefulsets-and-jobs#jobs-and-cronjobs\">part 2</a>.\nPods created by Jobs are intended to run once until completion. However, neither the completed Jobs nor the Pods are removed automatically. Those are preserved so that the execution logs can be reviewed after job execution.</p><p>Our controller has to do 3 things:</p><ul>\n<li>Create a Job from a Countdown</li>\n<li>Reschedule Jobs until the number of executions defined in Countdown (the <em>length</em>) has been completed.</li>\n<li>Clean all Jobs and Pods after the execution</li>\n</ul><p>To implement the controller we need to do some low-level stuff and access the Kuberneter directly using the REST APIs.</p><p>By listening to the Kubernetes API at <code class=\"language-text\">/apis/stable.dwk/v1/countdowns?watch=true</code> we will receive an ADDED for every Countdown object in the cluster. Then creating a job can be done by parsing the data from the message and POSTing a valid payload to <code class=\"language-text\">/apis/batch/v1/namespaces/&lt;namespace&gt;/jobs</code>.</p><p>For jobs, we'll listen to <code class=\"language-text\">/apis/batch/v1/jobs?watch=true</code> and wait for MODIFIED event where the success state is set to true and update the labels for the jobs to store the status. To delete a Job and its Pod we can send a delete request to <code class=\"language-text\">/api/v1/namespaces/&lt;namespace&gt;/pods/&lt;pod_name&gt;</code> and <code class=\"language-text\">/apis/batch/v1/namespaces/&lt;namespace&gt;/jobs/&lt;job_name&gt;</code></p><p>And finally, we can remove the countdown with a delete request to <code class=\"language-text\">/apis/stable.dwk/v1/namespaces/&lt;namespace&gt;/countdowns/&lt;countdown_name&gt;</code>.</p><p>A version of this controller can be found <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app10\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>. It has a readily built image <code class=\"language-text\">jakousa/dwk-app10-controller:sha-4256579</code>. We cannot just deploy it as it won't have access to the APIs. For this, we will need to define suitable access.</p><h2 id=\"rbac\" style=\"position:relative;\">RBAC<a href=\"#rbac\" aria-label=\"rbac permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>RBAC (Role-based access control) is an authorization method that allows us to define access for individual users, service accounts or groups by giving them roles. For our use case, we will define a ServiceAccount resource.</p><p><strong>serviceaccount.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">-</span>account</code></pre></div><p>and then specify the <em>serviceAccountName</em> for the deployment</p><p><strong>deployment.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">-</span>account\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jakousa/dwk<span class=\"token punctuation\">-</span>app10<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">:</span>sha<span class=\"token punctuation\">-</span><span class=\"token number\">4256579</span></code></pre></div><p>Next is defining the role and its rules. There are two types of roles: <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole\" target=\"_blank\" rel=\"noopener noreferrer\">ClusterRole</a> and <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole\" target=\"_blank\" rel=\"noopener noreferrer\">Role</a>. Roles are namespace-specific whereas ClusterRoles can access all of the namespaces - in our case, the controller will access all countdowns in all namespaces so a ClusterRole will be required.</p><p>The rules are defined with the apiGroup, resource and verbs. For example, the jobs was <code class=\"language-text\">/apis/batch/v1/jobs?watch=true</code> so it's in the apiGroup \"batch\" and resource \"jobs\" and the verbs see <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a>. Core API group is an empty string \"\" like in the case of pods.</p><p><strong>clusterrole.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">-</span>role\n<span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token comment\"># at the HTTP level, the name of the resource for accessing Pod</span>\n  <span class=\"token comment\"># objects is \"pods\"</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"pods\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"batch\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token comment\"># at the HTTP level, the name of the resource for accessing Job</span>\n  <span class=\"token comment\"># objects is \"jobs\"</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"jobs\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"stable.dwk\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"countdowns\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">]</span></code></pre></div><p>And finally bind the ServiceAccount and the role. There are two types of bindings as well: <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings\" target=\"_blank\" rel=\"noopener noreferrer\">ClusterRoleBinding</a> and <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings\" target=\"_blank\" rel=\"noopener noreferrer\">RoleBinding</a>. If we used a <em>RoleBinding</em> with a <em>ClusterRole</em> we would be able to restrict access to a single namespace. For example, if permission to access secrets is defined to a ClusterRole and we gave it via <em>RoleBinding</em> to a namespace called \"test\", they would only be able to access secrets in the namespace \"test\" - even though the role is a \"ClusterRole\".</p><p>In our case <em>ClusterRoleBinding</em> is required since we want the controller to access all of the namespaces from the namespace it's deployed in, in this case, namespace \"default\".</p><p><strong>clusterrolebinding.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>rolebinding\n<span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">-</span>role\n<span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> countdown<span class=\"token punctuation\">-</span>controller<span class=\"token punctuation\">-</span>account\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default</code></pre></div><p>After deploying all of that we can check logs after applying a countdown. (You may have to delete the pod to have it restart in case it didn't have access and it got stuck)</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl logs countdown-controller-dep-7ff598ffbf-q2rp5\n  &gt; app10@1.0.0 start /usr/src/app\n  &gt; node index.js\n\n  Scheduling new job number 20 for countdown doomsday to namespace default\n  Scheduling new job number 19 for countdown doomsday to namespace default\n  ...\n  Countdown ended. Removing countdown.\n  Doing cleanup</code></pre></div><text-box name=\"Choosing language for CRDs\" variant=\"hint\"><p>  The countdown example controller is implemented in two ways: using <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app10-go\" target=\"_blank\" rel=\"noopener noreferrer\">Go</a> and <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app10\" target=\"_blank\" rel=\"noopener noreferrer\">JavaScript</a>.</p><p>  The best option is perhaps <a href=\"https://go.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">Go</a> but this may not be the best place to learn a new language. The <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app10-go\" target=\"_blank\" rel=\"noopener noreferrer\">app10-go</a> README has info on what to do to get started with own CRD in Go!</p></text-box><exercise name='Exercise 5.01: DIY CRD & Controller'><p>  This exercise doesn't rely on previous exercises. You may again choose whichever technologies you want for the implementation.</p>  <p style=\"color:firebrick;\">This exercise is difficult!</p><p>  We need a <em>DummySite</em> resource that can be used to create an HTML page from any URL.</p><ol>\n<li>Create a \"DummySite\" resource that has a string property called \"website_url\".</li>\n<li>Create a controller that receives a created \"DummySite\" object from the API</li>\n<li>Have the controller create all of the resources that are required for the functionality.</li>\n</ol><p>  Refer to <a href=\"https://kubernetes.io/docs/reference/kubernetes-api/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/reference/kubernetes-api/</a> and <a href=\"https://kubernetes.io/docs/reference/using-api/api-concepts/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/reference/using-api/api-concepts/</a> for more information on Kubernetes API, and\n<a href=\"https://kubernetes.io/docs/reference/using-api/client-libraries/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/reference/using-api/client-libraries/</a> for information about client libraries.</p><p>You may also take inspiration from the material example apps: <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app10\" target=\"_blank\" rel=\"noopener noreferrer\">js</a>, <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app10-go\" target=\"_blank\" rel=\"noopener noreferrer\">go</a>. Note that the JavaScript app does not quite utilize the features of <a href=\"https://github.com/kubernetes-client/javascript\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Client</a>, but it calls the REST API directly.</p><p>Test that creating a DummySite resource with website_url \"<a href=\"https://example.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://example.com/</a>\"\ncreates a copy of the website. With a more complex website your \"copy\" does not need to be a complete one. Eg. in <a href=\"https://en.wikipedia.org/wiki/Kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">https://en.wikipedia.org/wiki/Kubernetes</a> the CSS styles can be broken:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/609f88728f7f5dea2774c347ef555dde/b8bf8/wikipedia.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.34782608695653%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAACF0lEQVQoz41Py4rUQBTND/kN4k5w7Uq/xIUgIvRiwI0oLl2IuBIEdZCxQVFQYWZ6ksqrU0klqVSSzrOSSlWn8+i2GHAhiM7hcrhVl3POvYoQXd8LIbZFQau6zfIWRwWOsk3WNO22ZTvWDazbtWxkbMyKHW8iwZJ0k9dVoWhaqKpY0/rzVWMYBQC5rm8MQwAtsizkOERVhapOmkoBaFzYIZ+QOAmCIMtzBePK90vPK3w/whiHYQQhiWQ4lo20E5bFAeCWVSPUdh1rmobzjnPOGFOiKAxDFEUBIUT6EZLY9qiqhzBsKeVFceB8u91SxhohOKVUiiVLpWQFIRQEYRD40oIQmSyfrvxx3dayRs8TjiNsu4/j0nHqOCZJkuBLTNOk2LYBoQ1hoOvENEPbJpYlCzsOvLgIVitsGAiAAELXNC3btgEAum4AcIFQpECY+EHmoRLola7XQC80rTTNynXT31tgzws8z03TVMbK6+I4xpg3Ta8YRuYj6rlDmQ+0mmk9bTZjmg6yqorWdS3PlFSWpdxzf4l5nvte8kHxfbh20Y9TWlCxm4du203jcLgalN24f7LMHr0LF8f+3Qfo+p03qrmWg2ma93/ib+JherFcPz4OFyfZ7fv42q2fp2YuB/O8/3/yMAzLV89OXj798vHD0eLoxs17hpteVTxN4/n3z2dfP63Pvi3fv339/CF2QU3bLMu6rvu3+BewTcHEZ9bu9QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/609f88728f7f5dea2774c347ef555dde/a0b58/wikipedia.webp 230w,\n/static/609f88728f7f5dea2774c347ef555dde/bc10c/wikipedia.webp 460w,\n/static/609f88728f7f5dea2774c347ef555dde/966d8/wikipedia.webp 920w,\n/static/609f88728f7f5dea2774c347ef555dde/445df/wikipedia.webp 1380w,\n/static/609f88728f7f5dea2774c347ef555dde/eaa3b/wikipedia.webp 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/609f88728f7f5dea2774c347ef555dde/81c8e/wikipedia.png 230w,\n/static/609f88728f7f5dea2774c347ef555dde/08a84/wikipedia.png 460w,\n/static/609f88728f7f5dea2774c347ef555dde/c0255/wikipedia.png 920w,\n/static/609f88728f7f5dea2774c347ef555dde/b1001/wikipedia.png 1380w,\n/static/609f88728f7f5dea2774c347ef555dde/b8bf8/wikipedia.png 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/609f88728f7f5dea2774c347ef555dde/c0255/wikipedia.png\" alt=\"wikipedia\" title=\"wikipedia\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p> The controller doesn't have to work perfectly in all circumstances. The following workflow should succeed:</p><ol>\n<li>apply role, account and binding.</li>\n<li>apply deployment.</li>\n<li>apply DummySite</li>\n</ol></exercise></div>","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"},"fileAbsolutePath":"/home/runner/work/kubernetes-hy.github.io/kubernetes-hy.github.io/data/part-5/2-custom-resource-definitions.md"},"allPages":{"edges":[{"node":{"id":"e4e5fe1c-25b1-57b3-87eb-e204e767a49c","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"9f6e26aa-46a9-523d-96e4-a57c65ec083d","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"3d7eac33-2990-59d1-a002-64e0b0f4f370","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"57c61ed7-37c4-5d0f-acd8-1dca0de6be4a","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"ecaa7011-87db-5ece-9b3c-1cfad638324a","frontmatter":{"path":"/","title":"Homepage"}}},{"node":{"id":"8ecc11b1-3298-589e-b97a-2a3a36861b8d","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"fb4fb717-329a-5d49-94c3-183aa16507e2","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"dab4b6a7-96cf-5efe-83f4-f5199c283e65","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"78948204-39a7-5f81-b9f4-3029400d5f82","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"fe4a80ee-85ba-536e-bbf5-c5695399f40f","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"0b237cfb-5f2a-5d8e-9aa0-0cf9b045db3a","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"19841be9-897c-577a-9f82-5a7381bc073c","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56f2a7a2-c9e2-5bbb-b6a7-76fd46592c69","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"f802a4ea-8d5a-503f-ad7b-d0138ab84c80","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"b810e0d9-0ac2-5073-a9dc-4ffd6649b7f7","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"40440141-c1a8-5723-858a-eea86119b5b6","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"708df9d2-30d1-518f-8066-80109a75c4dc","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"47a288aa-ece4-5ba6-ab6e-cbc63dbdc752","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"c8b1eb5e-3c98-59b3-b6e9-6173791d7e34","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"471982cb-da12-5799-a6b2-fa8a3e67aa0d","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"7bebb01b-c990-5e7e-a9aa-d60f10ba63dd","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"cbd58376-8d52-5297-b38d-653179a1226f","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"e4c53dca-867f-5293-9b28-657b695cd3f3","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"fd6ebeaa-c808-5f11-9bdc-30e4f69b8a2a","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"9e4ff8d0-2e6c-5d55-83a0-16ada460096d","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"0353d158-f751-57fd-94ce-373924da1b05","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"eae6660d-1d18-527a-bc1c-0f2f7ab54c6d","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"9f3c6f02-668a-517b-b7b6-1828f74c7200","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"e80b74e8-a23b-5d3c-808b-833a72ac739c","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"78f84327-bd7b-5b5d-941d-9fae8bca88d3","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"0a2d8cfd-8e40-59a7-a688-e8bdc9fb9e3a","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"39fb03b7-2abe-515a-a543-b812fcbfdba5","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"a899eeb2-4329-5c9b-aadf-2fb803fa9142","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"8a2e40fa-1703-5755-aa66-ac69bf2e291d","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"da15a80e-5316-5986-afcf-75d521065017","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"f5314214-d779-5fb4-a19f-ab7442f3fbb2","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"33c86b5c-3684-5006-b4e7-dbd0c7cc04bc","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}