{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-1/1-first-deploy","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Learning Objectives"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After this section you"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"are able to create and run a Kubernetes cluster locally with k3d"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"can deploy a simple application to Kubernetes"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"what-are-microservices","style":"position:relative;"},"children":[{"type":"text","value":"What are microservices?"},{"type":"element","tagName":"a","properties":{"href":"#what-are-microservices","ariaLabel":"what are microservices permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this course, we'll talk about microservices and create microservices. Before we get started with anything else we'll need to define what a microservice is. Currently, there are many different definitions for microservices."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For this course, we'll choose the definition set by Sam Newman in "},{"type":"element","tagName":"a","properties":{"href":"https://www.oreilly.com/library/view/building-microservices/9781491950340/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Building Microservices"}]},{"type":"text","value":": \""},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Microservices are small, autonomous services that work together"}]},{"type":"text","value":"\". The opposite of a microservice is a service that is self-contained and independent called a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Monolithic_application","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Monolith"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The misconception of microservices being a large number of extremely small services is proliferated by large enterprises. If you have an extremely large enterprise where teams don't even know the existence of other teams you may have an unconventionally large number of microservices. Due to the insanity of a large number of small services without any good reasoning, we witnessed the term monolith trending in 2020."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\"Monoliths are the future\" - Kelsey Hightower, Staff Developer Advocate at Google, "},{"type":"element","tagName":"a","properties":{"href":"https://changelog.com/posts/monoliths-are-the-future","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"\"Monoliths are the Future\""}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For the context of this unpopular opinion, Kelsey Hightower points out at \"The problem people try to solve with microservices doesn't really line up with reality\", leading to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Distributed Monoliths"}]},{"type":"text","value":" where you have a large number of microservices without a good reason."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\"Run a small team, not a tech behemoth? Embrace the monolith and make it majestic. You Deserve It!\" - David Heinemeier Hansson, cofounder & CTO at Basecamp, "},{"type":"element","tagName":"a","properties":{"href":"https://m.signalvnoise.com/the-majestic-monolith/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"\"The Majestic Monolith\""}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And this evolves into "},{"type":"element","tagName":"a","properties":{"href":"https://m.signalvnoise.com/the-majestic-monolith-can-become-the-citadel/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"\"The Majestic Monolith can become The Citadel\""}]},{"type":"text","value":" with the following: \"next step is The Citadel, which keeps the Majestic Monolith at the center, but supports it with a set of Outposts, each extracting a small subset of application responsibilities.\""}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When to use microservices? In the following video where Sam Newman and Martin Fowler discuss microservices, the answer is: \"When you've got a really good reason\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It also includes the top 3 reasons for using microservices:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Zero-downtime independent deployability"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Isolation of data and of processing around that data"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Use microservices to reflect the organizational structure"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"When To Use Microservices (And When Not To!)"}]}]},{"type":"element","tagName":"iframe","properties":{"width":560,"height":315,"src":"https://www.youtube-nocookie.com/embed/GBTdnfD6s5Q","frameBorder":"0","allow":"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowFullScreen":true},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A big topic in the video was also the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Distributed Monolith"}]},{"type":"text","value":", where the services are not independently deployable. This is possibly part of the reason why microservices are so hard to define. A simple definition such as \"A microservice is any service that is smaller than a monolith\", can be used to claim that a Distributed Monolith is a microservice. So a seemingly microservice architecture that does not have the benefits of a microservice architecture may actually be a disguised monolith."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since it is so hard to define rather than going first into microservices we should listen to the first two takeaways from the video that are \"One should use microservices as a means to obtain a desired outcome rather than for the sake of using a new technology\" and \"Microservices shouldn't be the default option. If you think a service architecture could help, try it with one of the modules from a very simple monolith typology and let it evolve from there\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, sometimes during this course, we'll do "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"arbitrary"}]},{"type":"text","value":" splits to our services just to show the features of Kubernetes. So even though we are doing \""},{"type":"element","tagName":"a","properties":{"href":"https://www.youtube.com/watch?v=y8OnoxKotPQ","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"microservices"}]},{"type":"text","value":"\" in this course, a healthy amount of skepticism is required around microservices in the real world. We will see at least one actual and well-justified use case for microservices with service scaling during the course."}]},{"type":"element","tagName":"h2","properties":{"id":"what-is-kubernetes","style":"position:relative;"},"children":[{"type":"text","value":"What is Kubernetes?"},{"type":"element","tagName":"a","properties":{"href":"#what-is-kubernetes","ariaLabel":"what is kubernetes permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's say you have 3 processes and 2 computers incapable of running all 3 processes. How would you approach this problem?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You'll have to start by deciding which 2 processes go on the same computer and which 1 will be on the different one. How would you fit them? By having the ones demanding the most resources and the least resources on the same machine or having the most demanding be on its own? Maybe you want to add one process and now you have to reorganize all of them. What happens when you have more than 2 computers and more than 3 processes? One of the processes is eating all of the memory and you need to get that away from the \"critical-bank-application\". Should we virtualize everything? Containers would solve that problem, right? Would you move the most important process to a new computer? Maybe some of the processes need to communicate with each other and now you have to deal with networking. What if one of the computers breaks? What about your Friday plans to visit the local Craft brewery?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"What if you could just define \"This process should have 6 copies using X amount of resources.\" and have the 2..N computers working as a single entity to fulfill your request? That's just one thing Kubernetes makes possible."}]},{"type":"element","tagName":"blockquote","properties":{"className":["twitter-tweet"]},"children":[{"type":"element","tagName":"p","properties":{"lang":"en","dir":"ltr"},"children":[{"type":"text","value":"In essence, Kubernetes is the sum of all the bash scripts and best practices that most system administrators would cobble together over time, presented as a single system behind a declarative set of APIs."}]},{"type":"text","value":"— Kelsey Hightower (@kelseyhightower) "},{"type":"element","tagName":"a","properties":{"href":"https://twitter.com/kelseyhightower/status/1125440400355782657?ref_src=twsrc%5Etfw"},"children":[{"type":"text","value":"May 6, 2019"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Or more officially:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"“Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications. It groups containers that make up an application into logical units for easy management and discovery.” - "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"kubernetes.io"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A container orchestration system such as Kubernetes is often required when maintaining containerized applications. The main responsibility of an orchestration system is the starting and stopping of containers. In addition, they offer networking between containers and health monitoring. Rather than manually doing "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker run critical-bank-application"}]},{"type":"text","value":" every time the application crashes, or restarting it if it becomes unresponsive, we want the system to keep the application automatically healthy."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You should already know an orchestration system, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"docker compose"}]},{"type":"text","value":", which also takes care of the same tasks; starting and stopping, networking and health monitoring. What makes Kubernetes special is the robust feature set for automating all of it."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Read "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/kubernetes-engine/kubernetes-comic/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"this comic"}]},{"type":"text","value":" and watch the video below to get a fast introduction. You may want to revisit these after this part!"}]},{"type":"element","tagName":"iframe","properties":{"width":560,"height":315,"src":"https://www.youtube-nocookie.com/embed/Q4W8Z-D-gcQ","frameBorder":"0","allow":"accelerometer; encrypted-media; gyroscope; picture-in-picture","allowFullScreen":true},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We will get started with a lightweight Kubernetes distribution. "},{"type":"element","tagName":"a","properties":{"href":"https://k3s.io/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"K3s - 5 less than K8s"}]},{"type":"text","value":", offers us an actual Kubernetes cluster that we can run in containers using "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/rancher/k3d","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"k3d"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"h3","properties":{"id":"kubernetes-cluster-with-k3d","style":"position:relative;"},"children":[{"type":"text","value":"Kubernetes cluster with k3d"},{"type":"element","tagName":"a","properties":{"href":"#kubernetes-cluster-with-k3d","ariaLabel":"kubernetes cluster with k3d permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"h4","properties":{"id":"what-is-a-cluster","style":"position:relative;"},"children":[{"type":"text","value":"What is a cluster?"},{"type":"element","tagName":"a","properties":{"href":"#what-is-a-cluster","ariaLabel":"what is a cluster permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A cluster is a group of machines, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"nodes"}]},{"type":"text","value":", that work together - in this case, they are part of a Kubernetes cluster. Kubernetes cluster can be of any size - a single node cluster would consist of one machine that hosts the Kubernetes control-plane (exposing API and maintaining the cluster) and that cluster can then be expanded with up to 5000 nodes total, as of Kubernetes v1.18."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We will use the term \"server node\" to refer to nodes with control-plane and \"agent node\" to refer to the nodes without that role. A basic kubernetes cluster may look like this:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 25.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvElEQVQY002QyQqFUAxD/f9Pc6NbBxAVNy6cZ9E8TqHyLhTa3CZNG7Rtq33ftSyLxbquFp5v26ayLFUUheX/f57P86z7vpUkiQIAGs/z1PM8Oo7D6vd9DfNh0zSZABiPHnrhgF3XZYODYRiMRBFFkcZx/EQ94jhWlmVGRBQyHLYLw1BN05iBPM8VIMBn3/dmGTcIQkaMVVi3rusPw5Wvn6apuq4z7BP0m0Dwm7gLVmUAQe5D/Obumt6qqvQD7GV+0ueMkqYAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/c328f2e874d20b6c24ce9a902820cdcc/a0b58/without_k3d.webp 230w","/static/c328f2e874d20b6c24ce9a902820cdcc/bc10c/without_k3d.webp 460w","/static/c328f2e874d20b6c24ce9a902820cdcc/52d01/without_k3d.webp 501w"],"sizes":["(max-width:","501px)","100vw,","501px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/c328f2e874d20b6c24ce9a902820cdcc/81c8e/without_k3d.png 230w","/static/c328f2e874d20b6c24ce9a902820cdcc/08a84/without_k3d.png 460w","/static/c328f2e874d20b6c24ce9a902820cdcc/55811/without_k3d.png 501w"],"sizes":["(max-width:","501px)","100vw,","501px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/c328f2e874d20b6c24ce9a902820cdcc/55811/without_k3d.png","alt":"without k3d","title":"without k3d","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"h4","properties":{"id":"starting-a-cluster-with-k3d","style":"position:relative;"},"children":[{"type":"text","value":"Starting a cluster with k3d"},{"type":"element","tagName":"a","properties":{"href":"#starting-a-cluster-with-k3d","ariaLabel":"starting a cluster with k3d permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We'll use k3d to create a group of Docker containers that run k3s. The installation instructions, or at least a link to them, are in "},{"type":"element","tagName":"a","properties":{"href":"/part-0#installing-k3d"},"children":[{"type":"text","value":"part 0"}]},{"type":"text","value":". The reason for using k3d is that it enables us to create a cluster without worrying about virtual machines or physical machines. With k3d our basic cluster will look like this:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 45.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABFElEQVQoz52R6YqDUAyFff+XE1RaEbeCuBVr627VZvhSBId2/kwgJPfm5GQzyrKUcRyl7/sP5Z/45XIR3/elKIqv2K7rZFkW8TxPjPv9rqBhGD6U/7ZtJUkSJX08Hl+xkK7rKmEYikEH27bJ6/X6ZQFgkev1qp0ix9gRi5zPZzEY43a7aSdUa5pGFRBvJpimSbWua/1DdtyeQ5eO47wJqR4EgViWpRYABICyLFOgbduSpqkSUIzxGZGY67qao4R5nmt3aBzHSkLSPM/qP59PJdoPQowxdxy7ZQpwFNUOCdARlUnCJ4nLEcOSgI9ld2DA7jnY0+n0vjIglK6O/v7+yz++Eb1yFEW6Q0b/r7LnqqrENE35AVu/r5efOrC5AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/94502863777ec6cc601ad486f6de63b4/a0b58/with_k3d.webp 230w","/static/94502863777ec6cc601ad486f6de63b4/bc10c/with_k3d.webp 460w","/static/94502863777ec6cc601ad486f6de63b4/52d01/with_k3d.webp 501w"],"sizes":["(max-width:","501px)","100vw,","501px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/94502863777ec6cc601ad486f6de63b4/81c8e/with_k3d.png 230w","/static/94502863777ec6cc601ad486f6de63b4/08a84/with_k3d.png 460w","/static/94502863777ec6cc601ad486f6de63b4/55811/with_k3d.png 501w"],"sizes":["(max-width:","501px)","100vw,","501px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/94502863777ec6cc601ad486f6de63b4/55811/with_k3d.png","alt":"with k3d","title":"with k3d","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Because the nodes are containers we are going to need to do a little bit of configuring to get those working like we want. We will get to that later. Creating our very own Kubernetes cluster with k3d is done by a single command."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ k3d cluster create -a 2"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This created a Kubernetes cluster with 2 agent nodes. As they're in Docker you can confirm that they exist with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker ps"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker ps\n  CONTAINER ID   IMAGE                            COMMAND                  CREATED          STATUS          PORTS                             NAMES\n  b25a9bb6c42f   ghcr.io/k3d-io/k3d-tools:5.4.1   \"/app/k3d-tools noop\"    56 seconds ago   Up 55 seconds                                     k3d-k3s-default-tools\n  19f992606131   ghcr.io/k3d-io/k3d-proxy:5.4.1   \"/bin/sh -c nginx-pr…\"   56 seconds ago   Up 32 seconds   80/tcp, 0.0.0.0:50122->6443/tcp   k3d-k3s-default-serverlb\n  7a8bf6a44099   rancher/k3s:v1.22.7-k3s1         \"/bin/k3d-entrypoint…\"   56 seconds ago   Up 43 seconds                                     k3d-k3s-default-agent-1\n  c85fbcbcf9b2   rancher/k3s:v1.22.7-k3s1         \"/bin/k3d-entrypoint…\"   56 seconds ago   Up 43 seconds                                     k3d-k3s-default-agent-0\n  7191a3bdae7a   rancher/k3s:v1.22.7-k3s1         \"/bin/k3d-entrypoint…\"   56 seconds ago   Up 52 seconds                                     k3d-k3s-default-server-0"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When scrolling a bit to the left we also see that port 6443 is opened to \"k3d-k3s-default-serverlb\", a useful \"load balancer\" proxy, that'll redirect a connection to 6443 into the server node, and that's how we can access the contents of the cluster. The port on our machine, above 50122, is randomly chosen. We could have opted out of the load balancer with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k3d cluster create -a 2 --no-lb"}]},{"type":"text","value":" and the port would be open straight to the server node. Having a load balancer will offer us a few features we wouldn't otherwise have, so let's keep it in."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"K3d helpfully also set up a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"kubeconfig"}]},{"type":"text","value":", a file that is used to organize information about clusters, users, namespaces, and authentication mechanisms. The contents of the file can be seen with the command "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k3d kubeconfig get k3s-default"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The other tool that we will be using in this course is "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/kubectl/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"kubectl"}]},{"type":"text","value":". Kubectl is the Kubernetes command-line tool and will allow us to interact with the cluster. Kubectl will read kubeconfig from the location in KUBECONFIG environment value or by default from "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"~/.kube/config"}]},{"type":"text","value":" and use the information to connect to the cluster. The contents include certificates, passwords and the address in which the cluster API. You can set the context with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl config use-context k3d-k3s-default"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now kubectl will be able to access the cluster"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl cluster-info\n  Kubernetes control plane is running at https://0.0.0.0:50122\n  CoreDNS is running at https://0.0.0.0:50122/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n  Metrics-server is running at https://0.0.0.0:50122/api/v1/namespaces/kube-system/services/https:metrics-server:https/proxy"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can see that kubectl is connected to the container "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"k3d-k3s-default-serverlb"}]},{"type":"text","value":" through (in this case) port 50122."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you want to stop / start the cluster you can simply run"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ k3d cluster stop\n  INFO[0000] Stopping cluster 'k3s-default'\n  INFO[0011] Stopped cluster 'k3s-default'\n\n$ k3d cluster start\n  INFO[0000] Using the k3d-tools node to gather environment information\n  INFO[0000] Starting existing tools node k3d-k3s-default-tools...\n  INFO[0000] Starting Node 'k3d-k3s-default-tools'\n  INFO[0001] Starting new tools node...\n  INFO[0001] Starting Node 'k3d-k3s-default-tools'\n  INFO[0003] Starting cluster 'k3s-default'\n  INFO[0003] Starting servers...\n  INFO[0003] Starting Node 'k3d-k3s-default-server-0'\n  INFO[0010] Starting agents...\n  INFO[0010] Starting Node 'k3d-k3s-default-agent-1'\n  INFO[0011] Starting Node 'k3d-k3s-default-agent-0'\n  INFO[0027] Starting helpers...\n  INFO[0027] Starting Node 'k3d-k3s-default-serverlb'\n  INFO[0027] Starting Node 'k3d-k3s-default-tools'\n  INFO[0035] Injecting records for hostAliases (incl. host.k3d.internal) and for 5 network members into CoreDNS configmap...\n  INFO[0038] Started cluster 'k3s-default'"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For now, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"we're going to need the cluster running"}]},{"type":"text","value":", but if we want to remove the cluster we can run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k3d cluster delete"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"h2","properties":{"id":"first-deploy","style":"position:relative;"},"children":[{"type":"text","value":"First Deploy"},{"type":"element","tagName":"a","properties":{"href":"#first-deploy","ariaLabel":"first deploy permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"h3","properties":{"id":"preparing-for-first-deploy","style":"position:relative;"},"children":[{"type":"text","value":"Preparing for first deploy"},{"type":"element","tagName":"a","properties":{"href":"#preparing-for-first-deploy","ariaLabel":"preparing for first deploy permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before we can deploy anything we'll need to do a small application to deploy. During the course, you will develop your own application. The technologies used for the application do not matter - for the examples we're going to use "},{"type":"element","tagName":"a","properties":{"href":"https://nodejs.org/en/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Node.js"}]},{"type":"text","value":" but the example application will be offered through GitHub as well as Docker Hub."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's launch an application that generates and outputs a hash every 5 seconds or so."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I have prepared one "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app1","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":", you can test it with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker run jakousa/dwk-app1"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To deploy an image, we need the cluster to have access to the image. By default, Kubernetes is intended to be used with a registry. K3d offers "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"import-images"}]},{"type":"text","value":" command, but that won't work when we switch to non-k3d solutions. We will use the familiar registry "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Docker Hub"}]},{"type":"text","value":", which we also used in "},{"type":"element","tagName":"a","properties":{"href":"http://devopswithdocker.com/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"DevOps with Docker"}]},{"type":"text","value":". If you've never used Docker Hub, it is the place where the Docker client defaults to. E.g. when you run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker pull nginx"}]},{"type":"text","value":", the nginx image comes from Docker Hub. See the course "},{"type":"element","tagName":"a","properties":{"href":"https://devopswithdocker.com/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"DevOps for Docker"}]},{"type":"text","value":" for further details e.g. on pushing your images to Docker Hub if needed."}]},{"type":"element","tagName":"text-box","properties":{"name":"Example applications","variant":"hint"},"children":[{"type":"text","value":"\nIn the future, the material will use the offered applications in the commands. You may follow along by changing the image to your application. Almost everything is found in the same repository "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example"},"children":[{"type":"text","value":"https://github.com/kubernetes-hy/material-example"}]},{"type":"text","value":".\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we are finally ready to deploy our first app into Kubernetes!"}]},{"type":"element","tagName":"h3","properties":{"id":"deployment","style":"position:relative;"},"children":[{"type":"text","value":"Deployment"},{"type":"element","tagName":"a","properties":{"href":"#deployment","ariaLabel":"deployment permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To deploy an application, we will need to create a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"deployment"}]},{"type":"text","value":" object with the image."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl create deployment hashgenerator-dep --image=jakousa/dwk-app1\n  deployment.apps/hashgenerator-dep created"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This action created a few things for us to look at"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"deployment"}]},{"type":"text","value":" resource and"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/pods/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"pod"}]},{"type":"text","value":" resource."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"h4","properties":{"id":"what-is-a-pod","style":"position:relative;"},"children":[{"type":"text","value":"What is a Pod?"},{"type":"element","tagName":"a","properties":{"href":"#what-is-a-pod","ariaLabel":"what is a pod permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Pod"}]},{"type":"text","value":" is an abstraction around one or more containers. Pods provide a context for 1..N containers so that they can share storage and a network. It's very much like how you have used containers to define environments for a single process. They can be thought of as a container of containers. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Most"}]},{"type":"text","value":" of the same rules apply: it is deleted if the containers within stop running and contained files will be lost with it."}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 731px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 24.782608695652172%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6ElEQVQY02WQS66DMAxFWWV30qp6k66jnbSrQUwRE4YIEEH8P+KnNHZ9U+jkRXJk5zrXJ3HCMKSmabiqKqrrmpVSXJYlS05y9tZac5IkF8/zzvM8o0+LDo3zPEfNRVGYrus4jmPlyMZS0DiOjICA6PsetWZZ67q+giD44+/S27bZ4VmW2TvGGJzTMAzsRFFkJCyRTCJpxkRO0xTkmoh4WZa77/vXwxC9ojMMQCjkBKFtW3KAjSfABDkMMRW5PP8gfAjh7TCcpsn2I/BdIP4ZypNDy0sEbtrxUdvLu+HTdd3Trv3rO3J81Qdh3Hh1gJHqOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/44b180d0bf8c0d75212b5e04fdb8f487/a0b58/pods.webp 230w","/static/44b180d0bf8c0d75212b5e04fdb8f487/bc10c/pods.webp 460w","/static/44b180d0bf8c0d75212b5e04fdb8f487/feeb6/pods.webp 731w"],"sizes":["(max-width:","731px)","100vw,","731px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/44b180d0bf8c0d75212b5e04fdb8f487/81c8e/pods.png 230w","/static/44b180d0bf8c0d75212b5e04fdb8f487/08a84/pods.png 460w","/static/44b180d0bf8c0d75212b5e04fdb8f487/6e9ba/pods.png 731w"],"sizes":["(max-width:","731px)","100vw,","731px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/44b180d0bf8c0d75212b5e04fdb8f487/6e9ba/pods.png","alt":"pods","title":"pods","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Reading through the documentation or searching the internet are not the only ways to find information about the different resources Kubernetes has. We can get access to simple explanations straight from our command line using "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl explain RESOURCE"}]},{"type":"text","value":" command."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For example, to get a description of what a Pod is and its mandatory fields, we can use the following command."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl explain pod\n  KIND:     Pod\n  VERSION:  v1\n\n  DESCRIPTION:\n       Pod is a collection of containers that can run on a host. This resource is\n       created by clients and scheduled onto hosts."}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In Kubernetes, all entities that exist are called "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/overview/working-with-objects/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"objects"}]},{"type":"text","value":". You can list all objects of a resource with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get RESOURCE"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ kubectl get pods\n  NAME                               READY   STATUS    RESTARTS   AGE\n  hashgenerator-dep-6965c5c7-2pkxc   1/1     Running   0          2m1s"}]}]}]},{"type":"element","tagName":"h4","properties":{"id":"what-is-a-deployment-resource","style":"position:relative;"},"children":[{"type":"text","value":"What is a Deployment resource?"},{"type":"element","tagName":"a","properties":{"href":"#what-is-a-deployment-resource","ariaLabel":"what is a deployment resource permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"deployment"}]},{"type":"text","value":" resource takes care of deployment. It's a way to tell Kubernetes what container you want, how they should be running and how many of them should be running."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While we created the Deployment we also created a "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ReplicaSet"}]},{"type":"text","value":" object. ReplicaSets are used to tell how many replicas of a Pod you want. It will delete or create Pods until the number of Pods you want is running. ReplicaSets are managed by Deployments and you do not need to manually define or modify them. If you want to manage the number of replicas, you can edit the Deployment and it will take care of modifying the ReplicaSet."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can view the deployments as follows:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl get deployments\n  NAME                READY   UP-TO-DATE   AVAILABLE   AGE\n  hashgenerator-dep   1/1     1            1           54s"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1/1 replicas are ready! We will try multiple replicas later. If your status doesn't look like this check "},{"type":"element","tagName":"a","properties":{"href":"/known-problems-solutions#first-deployment"},"children":[{"type":"text","value":"this page"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To see the output we can run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl logs -f hashgenerator-dep-6965c5c7-2pkxc"}]}]},{"type":"element","tagName":"text-box","properties":{"name":"Automatic completion","variant":"hint"},"children":[{"type":"text","value":"\nYou can use `source <(kubectl completion bash)` to save yourself from a lot of headaches. Add it to .bashrc for an automatic load. (Also available for zsh). If you've never used completion read this "},{"type":"element","tagName":"a","properties":{"href":"https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial"},"children":[{"type":"text","value":" tutorial "}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A helpful list for other commands from docker-cli translated to kubectl is available here "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/reference/kubectl/docker-cli-to-kubectl/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/reference/kubectl/docker-cli-to-kubectl/"}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.01: Getting started"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Exercises can be done with any language and framework you want."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create an application that generates a random string on startup, stores this string into memory, and outputs it every 5 seconds with a timestamp. e.g."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"plaintext"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-plaintext"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-plaintext"]},"children":[{"type":"text","value":"2020-03-30T12:15:17.705Z: 8523ecb1-c716-4cb6-a044-b9e83bb98e43\n2020-03-30T12:15:22.705Z: 8523ecb1-c716-4cb6-a044-b9e83bb98e43"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Deploy it into your Kubernetes cluster and confirm that it's running with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl logs ..."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You will keep building this application in the future exercises. This application will be called \"Log output\"."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.02: Project v0.1"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Project can be done with any language and framework you want"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The project will be a simple todo application with the familiar features of create, read, update, and delete (CRUD). We'll develop it during all parts of this course. Check the title of the exercise for \"Project vX.Y\" to know it is about building the project."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Todo is a text like \"I need to clean the house\" that can be in state of not-done or done."}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 453px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 110.43478260869566%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAADZElEQVQ4y5VUSUyTQRQeW1yOLlfsUWxsI/GAidGQEImcDE20WG8QjcDJiHjhwHIR9Wh6ElNTLGkpiknTJi490YYDS1nLTiiUnbb0L9CmYMbvjX+bRv0RJnmZ5e3fe28Y+8daW1tT0760tGTb2NjgQ0NDqcHBwRTuHDwn8TjnanbUtbi4KITX19e/7O3t8UAgICgajfJYLOY5tkEIn6A9FAo9W1lZ+ToyMtKFCLuWl5e/4f4iV+Z/S5UhjUajUhLS6/WqXNnDDOZlqLCw8KSSUGlpaV6u7JFTBpZPd3Z2PMDRsbu768DuWV1dfX6clMWKx+PCayKRcEORp1IpDsNcPv84tCgNDQ2svr6eDQ8PZ98kSRLCiMYs/V4hOAkhwsTW1tY72aBKrVZnMmJ1dXXCFoOQirzlUjgcFkB3d3ef9/v9mt7e3nwin8+ncblcF4iH9vlLj2wppl1cXHxGiWcwGE4rKqLH7iC1J5iISkxBJaahGm+3iDcxMVGCt1pQFREavXZubu428cbHx28gk+rt7e1KUBX68zH07hJePgIbDxwMAXwkEnGQ0tjYmCuZTNKdRk7wJicnvcTb3NxspztSz+phD1JFvel0ms/Pz/OpqSkuC7WT0ujo6CeaX0TKg8EgR4S0e+SxfE+yKJJwSAujGWD9/f03EboRAgZ4LUfvGTG310hpenq6CApGUDnxoFixsLBwXXZ2FWcjvQMuA873BgYGShSxLSsrUwTeZDKdUlR0u92X0BIFwKagp6dHi7bQtbW1nSOezWbLx5sOWWj7+vq0aBud3W6/SDyLxXIWslfwpsX3dplseL3eAgYgJQAv4WeRgEHk4OCAA4IHpIRUrQQ6cIyiaFEUkPC1Ew8pVkDvJ6YpBr04RlPa39+XqMs5FQVGspWEoUfyxHynOxUGX5fgwYCfeDMzMzV0hxFOjjKL/jwzQDUDXDMK8xaRfED6RaQ0OztbgUK0wlgjHDYiuleQN8kGdQjgJWa8ERPShEybEUjzoZ8E+vA+lF7DaBMRHL6Bs4fEA256pN2Kt2bItGA4WpBJixjyPwlpiL8Q2HgoDWruzG+DSHzEQ9/WZOAiyqZstVqZ0+lkDoeDdXZ2so6ODgJcLffhR2pm7Ek0fZIaGKP3WY7eBJhoIJJIPw0o0rinfwEP3Vesugk5lwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42cd00819d1db5789826b38bb7f95328/a0b58/project.webp 230w","/static/42cd00819d1db5789826b38bb7f95328/2430e/project.webp 453w"],"sizes":["(max-width:","453px)","100vw,","453px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42cd00819d1db5789826b38bb7f95328/81c8e/project.png 230w","/static/42cd00819d1db5789826b38bb7f95328/2108e/project.png 453w"],"sizes":["(max-width:","453px)","100vw,","453px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/42cd00819d1db5789826b38bb7f95328/2108e/project.png","alt":"Project evolution","title":"Project evolution","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dashed lines separate major differences across the course. Some exercises are not included in the picture. The connections between most pods are not included as well. You are free to do them however you want."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Keep this in mind if you want to avoid doing more work than necessary."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's get started!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a web server that outputs \"Server started in port NNNN\" when it is started and deploy it into your Kubernetes cluster. Please make it so that an environment variable PORT can be used to choose that port. You will not have access to the port when it is running in Kubernetes yet. We will configure the access when we get to networking."}]}]},{"type":"element","tagName":"h2","properties":{"id":"declarative-configuration-with-yaml","style":"position:relative;"},"children":[{"type":"text","value":"Declarative configuration with YAML"},{"type":"element","tagName":"a","properties":{"href":"#declarative-configuration-with-yaml","ariaLabel":"declarative configuration with yaml permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We created the deployment with"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl create deployment hashgenerator-dep --image=jakousa/dwk-app1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we wanted to scale it 4 times and update the image:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl scale deployment/hashgenerator-dep --replicas=4\n\n$ kubectl set image deployment/hashgenerator-dep dwk-app1=jakousa/dwk-app1:b7fc18de2376da80ff0cfc72cf581a9f94d10e64"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Things start to get really cumbersome. It is hard to imagine how someone in their right mind could be maintaining multiple applications like that. Thankfully we will now use a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"declarative"}]},{"type":"text","value":" approach where we define how things should be rather than how they should change. This is more sustainable in the long run than the imperative approach and will let us keep our sanity."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before redoing the previous steps via the declarative approach, let's take the existing deployment down."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl delete deployment hashgenerator-dep\n  deployment.apps \"hashgenerator-dep\" deleted"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"and create a new folder named "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"manifests"}]},{"type":"text","value":" and place a file called deployment.yaml with the following contents (you can check the example "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app1","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":") there:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"deployment.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashgenerator"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashgenerator\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashgenerator\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashgenerator\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" jakousa/dwk"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"b7fc18de2376da80ff0cfc72cf581a9f94d10e64"}]}]}]},{"type":"element","tagName":"text-box","properties":{"name":"Text editor of choice","variant":"hint"},"children":[{"type":"text","value":"\n  I personally use Visual studio code to create these yaml files. It has helpful autofill, definitions, and syntax check for Kubernetes with the extension Kubernetes by Microsoft. Even now it helpfully warns us that we haven't defined resource limitations. I won't care about that warning yet, but you can figure it out if you want to.\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This looks a lot like the docker-compose.yaml files we have previously written. Let's ignore what we don't know for now, which is mainly labels, and focus on the things that we know:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We're declaring what kind it is (kind: Deployment)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We're declaring it a name as metadata (name: hashgenerator-dep)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We're declaring that there should be one of them (replicas: 1)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We're declaring that it has a container that is from a certain image with a name"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Apply the deployment with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"apply"}]},{"type":"text","value":" command:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl apply -f manifests/deployment.yaml\n  deployment.apps/hashgenerator-dep created"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That's it, but for the sake of revision, let's delete it and create it again:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl delete -f manifests/deployment.yaml\n  deployment.apps \"hashgenerator-dep\" deleted\n\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app1/manifests/deployment.yaml\n  deployment.apps/hashgenerator-dep created"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Woah! The fact that you can apply manifest from the internet just like that will come in handy."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instead of deleting the deployment, we could just apply a modified deployment on top of what we already have. Kubernetes will take care of rolling out a new version. By using tags (e.g. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"dwk/image:tag"}]},{"type":"text","value":") in the deployments, each time we update the image we can modify and apply the new deployment yaml. Previously you may have always used the 'latest' tag, or not thought about tags at all. From the tag Kubernetes will know that the image is a new one and pulls it."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When updating anything in Kubernetes the usage of delete is actually an anti-pattern and you should use it only as the last option. As long as you don't delete the resource Kubernetes will do a rolling update, ensuring minimum (or none) downtime for the application. On the topic of anti-patterns: you should also always avoid doing anything imperatively! If your files don't tell Kubernetes and your team what the state should be and instead you run commands that edit the state you are just lowering the "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Bus_factor","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"bus factor"}]},{"type":"text","value":" for your cluster and application."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.03: Declarative approach"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In your \"Log output\" application create the folder for manifests and move your deployment into a declarative file."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Make sure everything still works by restarting and following logs."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.04: Project v0.2"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a deployment.yaml for the project."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You won't have access to the port yet but that'll come soon."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note applying a new deployment won't update the application unless the tag is updated. You will not need to delete the deployment if you always come up with a new tag."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Your basic workflow may look something like this:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker build -t <image>:<new_tag>\n\n$ docker push <image>:<new_tag>"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then edit deployment.yaml so that the tag is updated to the <new_tag> and"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl apply -f manifests/deployment.yaml"}]}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Learning Objectives'><p>After this section you</p><ul>\n<li>are able to create and run a Kubernetes cluster locally with k3d</li>\n<li>can deploy a simple application to Kubernetes</li>\n</ul></text-box><h2 id=\"what-are-microservices\" style=\"position:relative;\">What are microservices?<a href=\"#what-are-microservices\" aria-label=\"what are microservices permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>In this course, we'll talk about microservices and create microservices. Before we get started with anything else we'll need to define what a microservice is. Currently, there are many different definitions for microservices.</p><p>For this course, we'll choose the definition set by Sam Newman in <a href=\"https://www.oreilly.com/library/view/building-microservices/9781491950340/\" target=\"_blank\" rel=\"noopener noreferrer\">Building Microservices</a>: \"<strong>Microservices are small, autonomous services that work together</strong>\". The opposite of a microservice is a service that is self-contained and independent called a <a href=\"https://en.wikipedia.org/wiki/Monolithic_application\" target=\"_blank\" rel=\"noopener noreferrer\">Monolith</a>.</p><p>The misconception of microservices being a large number of extremely small services is proliferated by large enterprises. If you have an extremely large enterprise where teams don't even know the existence of other teams you may have an unconventionally large number of microservices. Due to the insanity of a large number of small services without any good reasoning, we witnessed the term monolith trending in 2020.</p><ul>\n<li>\"Monoliths are the future\" - Kelsey Hightower, Staff Developer Advocate at Google, <a href=\"https://changelog.com/posts/monoliths-are-the-future\" target=\"_blank\" rel=\"noopener noreferrer\">\"Monoliths are the Future\"</a></li>\n</ul><p>For the context of this unpopular opinion, Kelsey Hightower points out at \"The problem people try to solve with microservices doesn't really line up with reality\", leading to <em>Distributed Monoliths</em> where you have a large number of microservices without a good reason.</p><ul>\n<li>\"Run a small team, not a tech behemoth? Embrace the monolith and make it majestic. You Deserve It!\" - David Heinemeier Hansson, cofounder &#x26; CTO at Basecamp, <a href=\"https://m.signalvnoise.com/the-majestic-monolith/\" target=\"_blank\" rel=\"noopener noreferrer\">\"The Majestic Monolith\"</a></li>\n</ul><p>And this evolves into <a href=\"https://m.signalvnoise.com/the-majestic-monolith-can-become-the-citadel/\" target=\"_blank\" rel=\"noopener noreferrer\">\"The Majestic Monolith can become The Citadel\"</a> with the following: \"next step is The Citadel, which keeps the Majestic Monolith at the center, but supports it with a set of Outposts, each extracting a small subset of application responsibilities.\"</p><p>When to use microservices? In the following video where Sam Newman and Martin Fowler discuss microservices, the answer is: \"When you've got a really good reason\".</p><p>It also includes the top 3 reasons for using microservices:</p><ul>\n<li>Zero-downtime independent deployability</li>\n<li>Isolation of data and of processing around that data</li>\n<li>Use microservices to reflect the organizational structure</li>\n</ul><p><strong>When To Use Microservices (And When Not To!)</strong></p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/GBTdnfD6s5Q\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe><p>A big topic in the video was also the <em>Distributed Monolith</em>, where the services are not independently deployable. This is possibly part of the reason why microservices are so hard to define. A simple definition such as \"A microservice is any service that is smaller than a monolith\", can be used to claim that a Distributed Monolith is a microservice. So a seemingly microservice architecture that does not have the benefits of a microservice architecture may actually be a disguised monolith.</p><p>Since it is so hard to define rather than going first into microservices we should listen to the first two takeaways from the video that are \"One should use microservices as a means to obtain a desired outcome rather than for the sake of using a new technology\" and \"Microservices shouldn't be the default option. If you think a service architecture could help, try it with one of the modules from a very simple monolith typology and let it evolve from there\".</p><p>However, sometimes during this course, we'll do <strong>arbitrary</strong> splits to our services just to show the features of Kubernetes. So even though we are doing \"<a href=\"https://www.youtube.com/watch?v=y8OnoxKotPQ\" target=\"_blank\" rel=\"noopener noreferrer\">microservices</a>\" in this course, a healthy amount of skepticism is required around microservices in the real world. We will see at least one actual and well-justified use case for microservices with service scaling during the course.</p><h2 id=\"what-is-kubernetes\" style=\"position:relative;\">What is Kubernetes?<a href=\"#what-is-kubernetes\" aria-label=\"what is kubernetes permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Let's say you have 3 processes and 2 computers incapable of running all 3 processes. How would you approach this problem?</p><p>You'll have to start by deciding which 2 processes go on the same computer and which 1 will be on the different one. How would you fit them? By having the ones demanding the most resources and the least resources on the same machine or having the most demanding be on its own? Maybe you want to add one process and now you have to reorganize all of them. What happens when you have more than 2 computers and more than 3 processes? One of the processes is eating all of the memory and you need to get that away from the \"critical-bank-application\". Should we virtualize everything? Containers would solve that problem, right? Would you move the most important process to a new computer? Maybe some of the processes need to communicate with each other and now you have to deal with networking. What if one of the computers breaks? What about your Friday plans to visit the local Craft brewery?</p><p>What if you could just define \"This process should have 6 copies using X amount of resources.\" and have the 2..N computers working as a single entity to fulfill your request? That's just one thing Kubernetes makes possible.</p><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">In essence, Kubernetes is the sum of all the bash scripts and best practices that most system administrators would cobble together over time, presented as a single system behind a declarative set of APIs.</p>&mdash; Kelsey Hightower (@kelseyhightower) <a href=\"https://twitter.com/kelseyhightower/status/1125440400355782657?ref_src=twsrc%5Etfw\">May 6, 2019</a></blockquote><p>Or more officially:</p><p>“Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications. It groups containers that make up an application into logical units for easy management and discovery.” - <a href=\"https://kubernetes.io/\" target=\"_blank\" rel=\"noopener noreferrer\">kubernetes.io</a></p><p>A container orchestration system such as Kubernetes is often required when maintaining containerized applications. The main responsibility of an orchestration system is the starting and stopping of containers. In addition, they offer networking between containers and health monitoring. Rather than manually doing <code class=\"language-text\">docker run critical-bank-application</code> every time the application crashes, or restarting it if it becomes unresponsive, we want the system to keep the application automatically healthy.</p><p>You should already know an orchestration system, <em>docker compose</em>, which also takes care of the same tasks; starting and stopping, networking and health monitoring. What makes Kubernetes special is the robust feature set for automating all of it.</p><p>Read <a href=\"https://cloud.google.com/kubernetes-engine/kubernetes-comic/\" target=\"_blank\" rel=\"noopener noreferrer\">this comic</a> and watch the video below to get a fast introduction. You may want to revisit these after this part!</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/Q4W8Z-D-gcQ\" frameborder=\"0\" allow=\"accelerometer; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe><p>We will get started with a lightweight Kubernetes distribution. <a href=\"https://k3s.io/\" target=\"_blank\" rel=\"noopener noreferrer\">K3s - 5 less than K8s</a>, offers us an actual Kubernetes cluster that we can run in containers using <a href=\"https://github.com/rancher/k3d\" target=\"_blank\" rel=\"noopener noreferrer\">k3d</a>.</p><h3 id=\"kubernetes-cluster-with-k3d\" style=\"position:relative;\">Kubernetes cluster with k3d<a href=\"#kubernetes-cluster-with-k3d\" aria-label=\"kubernetes cluster with k3d permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><h4 id=\"what-is-a-cluster\" style=\"position:relative;\">What is a cluster?<a href=\"#what-is-a-cluster\" aria-label=\"what is a cluster permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>A cluster is a group of machines, <em>nodes</em>, that work together - in this case, they are part of a Kubernetes cluster. Kubernetes cluster can be of any size - a single node cluster would consist of one machine that hosts the Kubernetes control-plane (exposing API and maintaining the cluster) and that cluster can then be expanded with up to 5000 nodes total, as of Kubernetes v1.18.</p><p>We will use the term \"server node\" to refer to nodes with control-plane and \"agent node\" to refer to the nodes without that role. A basic kubernetes cluster may look like this:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; margin-bottom: 1rem;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 25.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvElEQVQY002QyQqFUAxD/f9Pc6NbBxAVNy6cZ9E8TqHyLhTa3CZNG7Rtq33ftSyLxbquFp5v26ayLFUUheX/f57P86z7vpUkiQIAGs/z1PM8Oo7D6vd9DfNh0zSZABiPHnrhgF3XZYODYRiMRBFFkcZx/EQ94jhWlmVGRBQyHLYLw1BN05iBPM8VIMBn3/dmGTcIQkaMVVi3rusPw5Wvn6apuq4z7BP0m0Dwm7gLVmUAQe5D/Obumt6qqvQD7GV+0ueMkqYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/c328f2e874d20b6c24ce9a902820cdcc/a0b58/without_k3d.webp 230w,\n/static/c328f2e874d20b6c24ce9a902820cdcc/bc10c/without_k3d.webp 460w,\n/static/c328f2e874d20b6c24ce9a902820cdcc/52d01/without_k3d.webp 501w\" sizes=\"(max-width: 501px) 100vw, 501px\" type=\"image/webp\">\n        <source srcset=\"/static/c328f2e874d20b6c24ce9a902820cdcc/81c8e/without_k3d.png 230w,\n/static/c328f2e874d20b6c24ce9a902820cdcc/08a84/without_k3d.png 460w,\n/static/c328f2e874d20b6c24ce9a902820cdcc/55811/without_k3d.png 501w\" sizes=\"(max-width: 501px) 100vw, 501px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/c328f2e874d20b6c24ce9a902820cdcc/55811/without_k3d.png\" alt=\"without k3d\" title=\"without k3d\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n    </span><h4 id=\"starting-a-cluster-with-k3d\" style=\"position:relative;\">Starting a cluster with k3d<a href=\"#starting-a-cluster-with-k3d\" aria-label=\"starting a cluster with k3d permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>We'll use k3d to create a group of Docker containers that run k3s. The installation instructions, or at least a link to them, are in <a href=\"/part-0#installing-k3d\">part 0</a>. The reason for using k3d is that it enables us to create a cluster without worrying about virtual machines or physical machines. With k3d our basic cluster will look like this:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; margin-bottom: 1rem;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABFElEQVQoz52R6YqDUAyFff+XE1RaEbeCuBVr627VZvhSBId2/kwgJPfm5GQzyrKUcRyl7/sP5Z/45XIR3/elKIqv2K7rZFkW8TxPjPv9rqBhGD6U/7ZtJUkSJX08Hl+xkK7rKmEYikEH27bJ6/X6ZQFgkev1qp0ix9gRi5zPZzEY43a7aSdUa5pGFRBvJpimSbWua/1DdtyeQ5eO47wJqR4EgViWpRYABICyLFOgbduSpqkSUIzxGZGY67qao4R5nmt3aBzHSkLSPM/qP59PJdoPQowxdxy7ZQpwFNUOCdARlUnCJ4nLEcOSgI9ld2DA7jnY0+n0vjIglK6O/v7+yz++Eb1yFEW6Q0b/r7LnqqrENE35AVu/r5efOrC5AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/94502863777ec6cc601ad486f6de63b4/a0b58/with_k3d.webp 230w,\n/static/94502863777ec6cc601ad486f6de63b4/bc10c/with_k3d.webp 460w,\n/static/94502863777ec6cc601ad486f6de63b4/52d01/with_k3d.webp 501w\" sizes=\"(max-width: 501px) 100vw, 501px\" type=\"image/webp\">\n        <source srcset=\"/static/94502863777ec6cc601ad486f6de63b4/81c8e/with_k3d.png 230w,\n/static/94502863777ec6cc601ad486f6de63b4/08a84/with_k3d.png 460w,\n/static/94502863777ec6cc601ad486f6de63b4/55811/with_k3d.png 501w\" sizes=\"(max-width: 501px) 100vw, 501px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/94502863777ec6cc601ad486f6de63b4/55811/with_k3d.png\" alt=\"with k3d\" title=\"with k3d\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n    </span><p>Because the nodes are containers we are going to need to do a little bit of configuring to get those working like we want. We will get to that later. Creating our very own Kubernetes cluster with k3d is done by a single command.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ k3d cluster create -a 2</code></pre></div><p>This created a Kubernetes cluster with 2 agent nodes. As they're in Docker you can confirm that they exist with <code class=\"language-text\">docker ps</code>.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker ps\n  CONTAINER ID   IMAGE                            COMMAND                  CREATED          STATUS          PORTS                             NAMES\n  b25a9bb6c42f   ghcr.io/k3d-io/k3d-tools:5.4.1   &quot;/app/k3d-tools noop&quot;    56 seconds ago   Up 55 seconds                                     k3d-k3s-default-tools\n  19f992606131   ghcr.io/k3d-io/k3d-proxy:5.4.1   &quot;/bin/sh -c nginx-pr…&quot;   56 seconds ago   Up 32 seconds   80/tcp, 0.0.0.0:50122-&gt;6443/tcp   k3d-k3s-default-serverlb\n  7a8bf6a44099   rancher/k3s:v1.22.7-k3s1         &quot;/bin/k3d-entrypoint…&quot;   56 seconds ago   Up 43 seconds                                     k3d-k3s-default-agent-1\n  c85fbcbcf9b2   rancher/k3s:v1.22.7-k3s1         &quot;/bin/k3d-entrypoint…&quot;   56 seconds ago   Up 43 seconds                                     k3d-k3s-default-agent-0\n  7191a3bdae7a   rancher/k3s:v1.22.7-k3s1         &quot;/bin/k3d-entrypoint…&quot;   56 seconds ago   Up 52 seconds                                     k3d-k3s-default-server-0</code></pre></div><p>When scrolling a bit to the left we also see that port 6443 is opened to \"k3d-k3s-default-serverlb\", a useful \"load balancer\" proxy, that'll redirect a connection to 6443 into the server node, and that's how we can access the contents of the cluster. The port on our machine, above 50122, is randomly chosen. We could have opted out of the load balancer with <code class=\"language-text\">k3d cluster create -a 2 --no-lb</code> and the port would be open straight to the server node. Having a load balancer will offer us a few features we wouldn't otherwise have, so let's keep it in.</p><p>K3d helpfully also set up a <a href=\"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/\" target=\"_blank\" rel=\"noopener noreferrer\">kubeconfig</a>, a file that is used to organize information about clusters, users, namespaces, and authentication mechanisms. The contents of the file can be seen with the command <code class=\"language-text\">k3d kubeconfig get k3s-default</code>.</p><p>The other tool that we will be using in this course is <a href=\"https://kubernetes.io/docs/reference/kubectl/\" target=\"_blank\" rel=\"noopener noreferrer\">kubectl</a>. Kubectl is the Kubernetes command-line tool and will allow us to interact with the cluster. Kubectl will read kubeconfig from the location in KUBECONFIG environment value or by default from <code class=\"language-text\">~/.kube/config</code> and use the information to connect to the cluster. The contents include certificates, passwords and the address in which the cluster API. You can set the context with <code class=\"language-text\">kubectl config use-context k3d-k3s-default</code>.</p><p>Now kubectl will be able to access the cluster</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl cluster-info\n  Kubernetes control plane is running at https://0.0.0.0:50122\n  CoreDNS is running at https://0.0.0.0:50122/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n  Metrics-server is running at https://0.0.0.0:50122/api/v1/namespaces/kube-system/services/https:metrics-server:https/proxy</code></pre></div><p>We can see that kubectl is connected to the container <em>k3d-k3s-default-serverlb</em> through (in this case) port 50122.</p><p>If you want to stop / start the cluster you can simply run</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ k3d cluster stop\n  INFO[0000] Stopping cluster &#39;k3s-default&#39;\n  INFO[0011] Stopped cluster &#39;k3s-default&#39;\n\n$ k3d cluster start\n  INFO[0000] Using the k3d-tools node to gather environment information\n  INFO[0000] Starting existing tools node k3d-k3s-default-tools...\n  INFO[0000] Starting Node &#39;k3d-k3s-default-tools&#39;\n  INFO[0001] Starting new tools node...\n  INFO[0001] Starting Node &#39;k3d-k3s-default-tools&#39;\n  INFO[0003] Starting cluster &#39;k3s-default&#39;\n  INFO[0003] Starting servers...\n  INFO[0003] Starting Node &#39;k3d-k3s-default-server-0&#39;\n  INFO[0010] Starting agents...\n  INFO[0010] Starting Node &#39;k3d-k3s-default-agent-1&#39;\n  INFO[0011] Starting Node &#39;k3d-k3s-default-agent-0&#39;\n  INFO[0027] Starting helpers...\n  INFO[0027] Starting Node &#39;k3d-k3s-default-serverlb&#39;\n  INFO[0027] Starting Node &#39;k3d-k3s-default-tools&#39;\n  INFO[0035] Injecting records for hostAliases (incl. host.k3d.internal) and for 5 network members into CoreDNS configmap...\n  INFO[0038] Started cluster &#39;k3s-default&#39;</code></pre></div><p>For now, <strong>we're going to need the cluster running</strong>, but if we want to remove the cluster we can run <code class=\"language-text\">k3d cluster delete</code>.</p><h2 id=\"first-deploy\" style=\"position:relative;\">First Deploy<a href=\"#first-deploy\" aria-label=\"first deploy permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><h3 id=\"preparing-for-first-deploy\" style=\"position:relative;\">Preparing for first deploy<a href=\"#preparing-for-first-deploy\" aria-label=\"preparing for first deploy permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Before we can deploy anything we'll need to do a small application to deploy. During the course, you will develop your own application. The technologies used for the application do not matter - for the examples we're going to use <a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener noreferrer\">Node.js</a> but the example application will be offered through GitHub as well as Docker Hub.</p><p>Let's launch an application that generates and outputs a hash every 5 seconds or so.</p><p>I have prepared one <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app1\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>, you can test it with <code class=\"language-text\">docker run jakousa/dwk-app1</code>.</p><p>To deploy an image, we need the cluster to have access to the image. By default, Kubernetes is intended to be used with a registry. K3d offers <code class=\"language-text\">import-images</code> command, but that won't work when we switch to non-k3d solutions. We will use the familiar registry <em>Docker Hub</em>, which we also used in <a href=\"http://devopswithdocker.com/\" target=\"_blank\" rel=\"noopener noreferrer\">DevOps with Docker</a>. If you've never used Docker Hub, it is the place where the Docker client defaults to. E.g. when you run <code class=\"language-text\">docker pull nginx</code>, the nginx image comes from Docker Hub. See the course <a href=\"https://devopswithdocker.com/\" target=\"_blank\" rel=\"noopener noreferrer\">DevOps for Docker</a> for further details e.g. on pushing your images to Docker Hub if needed.</p><text-box name=\"Example applications\" variant=\"hint\">\nIn the future, the material will use the offered applications in the commands. You may follow along by changing the image to your application. Almost everything is found in the same repository <a href=\"https://github.com/kubernetes-hy/material-example\">https://github.com/kubernetes-hy/material-example</a>.\n</text-box><p>Now we are finally ready to deploy our first app into Kubernetes!</p><h3 id=\"deployment\" style=\"position:relative;\">Deployment<a href=\"#deployment\" aria-label=\"deployment permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>To deploy an application, we will need to create a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/\" target=\"_blank\" rel=\"noopener noreferrer\">deployment</a> object with the image.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl create deployment hashgenerator-dep --image=jakousa/dwk-app1\n  deployment.apps/hashgenerator-dep created</code></pre></div><p>This action created a few things for us to look at</p><ul>\n<li>a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/\" target=\"_blank\" rel=\"noopener noreferrer\">deployment</a> resource and</li>\n<li>a <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/\" target=\"_blank\" rel=\"noopener noreferrer\">pod</a> resource.</li>\n</ul><h4 id=\"what-is-a-pod\" style=\"position:relative;\">What is a Pod?<a href=\"#what-is-a-pod\" aria-label=\"what is a pod permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p><em>Pod</em> is an abstraction around one or more containers. Pods provide a context for 1..N containers so that they can share storage and a network. It's very much like how you have used containers to define environments for a single process. They can be thought of as a container of containers. <em>Most</em> of the same rules apply: it is deleted if the containers within stop running and contained files will be lost with it.</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 731px; margin-bottom: 1rem;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 24.782608695652172%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6ElEQVQY02WQS66DMAxFWWV30qp6k66jnbSrQUwRE4YIEEH8P+KnNHZ9U+jkRXJk5zrXJ3HCMKSmabiqKqrrmpVSXJYlS05y9tZac5IkF8/zzvM8o0+LDo3zPEfNRVGYrus4jmPlyMZS0DiOjICA6PsetWZZ67q+giD44+/S27bZ4VmW2TvGGJzTMAzsRFFkJCyRTCJpxkRO0xTkmoh4WZa77/vXwxC9ojMMQCjkBKFtW3KAjSfABDkMMRW5PP8gfAjh7TCcpsn2I/BdIP4ZypNDy0sEbtrxUdvLu+HTdd3Trv3rO3J81Qdh3Hh1gJHqOQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/44b180d0bf8c0d75212b5e04fdb8f487/a0b58/pods.webp 230w,\n/static/44b180d0bf8c0d75212b5e04fdb8f487/bc10c/pods.webp 460w,\n/static/44b180d0bf8c0d75212b5e04fdb8f487/feeb6/pods.webp 731w\" sizes=\"(max-width: 731px) 100vw, 731px\" type=\"image/webp\">\n        <source srcset=\"/static/44b180d0bf8c0d75212b5e04fdb8f487/81c8e/pods.png 230w,\n/static/44b180d0bf8c0d75212b5e04fdb8f487/08a84/pods.png 460w,\n/static/44b180d0bf8c0d75212b5e04fdb8f487/6e9ba/pods.png 731w\" sizes=\"(max-width: 731px) 100vw, 731px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/44b180d0bf8c0d75212b5e04fdb8f487/6e9ba/pods.png\" alt=\"pods\" title=\"pods\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n    </span><p>Reading through the documentation or searching the internet are not the only ways to find information about the different resources Kubernetes has. We can get access to simple explanations straight from our command line using <code class=\"language-text\">kubectl explain RESOURCE</code> command.</p><p>For example, to get a description of what a Pod is and its mandatory fields, we can use the following command.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl explain pod\n  KIND:     Pod\n  VERSION:  v1\n\n  DESCRIPTION:\n       Pod is a collection of containers that can run on a host. This resource is\n       created by clients and scheduled onto hosts.</code></pre></div><p>In Kubernetes, all entities that exist are called <a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/\" target=\"_blank\" rel=\"noopener noreferrer\">objects</a>. You can list all objects of a resource with <code class=\"language-text\">kubectl get RESOURCE</code>.</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl get pods\n  NAME                               READY   STATUS    RESTARTS   AGE\n  hashgenerator-dep-6965c5c7-2pkxc   1/1     Running   0          2m1s</code></pre></div><h4 id=\"what-is-a-deployment-resource\" style=\"position:relative;\">What is a Deployment resource?<a href=\"#what-is-a-deployment-resource\" aria-label=\"what is a deployment resource permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>A <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/\" target=\"_blank\" rel=\"noopener noreferrer\">deployment</a> resource takes care of deployment. It's a way to tell Kubernetes what container you want, how they should be running and how many of them should be running.</p><p>While we created the Deployment we also created a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/\" target=\"_blank\" rel=\"noopener noreferrer\">ReplicaSet</a> object. ReplicaSets are used to tell how many replicas of a Pod you want. It will delete or create Pods until the number of Pods you want is running. ReplicaSets are managed by Deployments and you do not need to manually define or modify them. If you want to manage the number of replicas, you can edit the Deployment and it will take care of modifying the ReplicaSet.</p><p>You can view the deployments as follows:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl get deployments\n  NAME                READY   UP-TO-DATE   AVAILABLE   AGE\n  hashgenerator-dep   1/1     1            1           54s</code></pre></div><p>1/1 replicas are ready! We will try multiple replicas later. If your status doesn't look like this check <a href=\"/known-problems-solutions#first-deployment\">this page</a>.</p><p>To see the output we can run <code class=\"language-text\">kubectl logs -f hashgenerator-dep-6965c5c7-2pkxc</code></p><text-box name=\"Automatic completion\" variant=\"hint\">\nYou can use `source <(kubectl completion bash)` to save yourself from a lot of headaches. Add it to .bashrc for an automatic load. (Also available for zsh). If you've never used completion read this <a href=\"https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial\"> tutorial </a>\n</text-box><p>A helpful list for other commands from docker-cli translated to kubectl is available here <a href=\"https://kubernetes.io/docs/reference/kubectl/docker-cli-to-kubectl/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/reference/kubectl/docker-cli-to-kubectl/</a></p><exercise name='Exercise 1.01: Getting started'><p><strong>Exercises can be done with any language and framework you want.</strong></p><p>Create an application that generates a random string on startup, stores this string into memory, and outputs it every 5 seconds with a timestamp. e.g.</p><div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">2020-03-30T12:15:17.705Z: 8523ecb1-c716-4cb6-a044-b9e83bb98e43\n2020-03-30T12:15:22.705Z: 8523ecb1-c716-4cb6-a044-b9e83bb98e43</code></pre></div><p>Deploy it into your Kubernetes cluster and confirm that it's running with <code class=\"language-text\">kubectl logs ...</code></p><p>You will keep building this application in the future exercises. This application will be called \"Log output\".</p></exercise><exercise name='Exercise 1.02: Project v0.1'><p><strong>Project can be done with any language and framework you want</strong></p><p>The project will be a simple todo application with the familiar features of create, read, update, and delete (CRUD). We'll develop it during all parts of this course. Check the title of the exercise for \"Project vX.Y\" to know it is about building the project.</p><p>Todo is a text like \"I need to clean the house\" that can be in state of not-done or done.</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 453px; margin-bottom: 1rem;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 110.43478260869566%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAADZElEQVQ4y5VUSUyTQRQeW1yOLlfsUWxsI/GAidGQEImcDE20WG8QjcDJiHjhwHIR9Wh6ElNTLGkpiknTJi490YYDS1nLTiiUnbb0L9CmYMbvjX+bRv0RJnmZ5e3fe28Y+8daW1tT0760tGTb2NjgQ0NDqcHBwRTuHDwn8TjnanbUtbi4KITX19e/7O3t8UAgICgajfJYLOY5tkEIn6A9FAo9W1lZ+ToyMtKFCLuWl5e/4f4iV+Z/S5UhjUajUhLS6/WqXNnDDOZlqLCw8KSSUGlpaV6u7JFTBpZPd3Z2PMDRsbu768DuWV1dfX6clMWKx+PCayKRcEORp1IpDsNcPv84tCgNDQ2svr6eDQ8PZ98kSRLCiMYs/V4hOAkhwsTW1tY72aBKrVZnMmJ1dXXCFoOQirzlUjgcFkB3d3ef9/v9mt7e3nwin8+ncblcF4iH9vlLj2wppl1cXHxGiWcwGE4rKqLH7iC1J5iISkxBJaahGm+3iDcxMVGCt1pQFREavXZubu428cbHx28gk+rt7e1KUBX68zH07hJePgIbDxwMAXwkEnGQ0tjYmCuZTNKdRk7wJicnvcTb3NxspztSz+phD1JFvel0ms/Pz/OpqSkuC7WT0ujo6CeaX0TKg8EgR4S0e+SxfE+yKJJwSAujGWD9/f03EboRAgZ4LUfvGTG310hpenq6CApGUDnxoFixsLBwXXZ2FWcjvQMuA873BgYGShSxLSsrUwTeZDKdUlR0u92X0BIFwKagp6dHi7bQtbW1nSOezWbLx5sOWWj7+vq0aBud3W6/SDyLxXIWslfwpsX3dplseL3eAgYgJQAv4WeRgEHk4OCAA4IHpIRUrQQ6cIyiaFEUkPC1Ew8pVkDvJ6YpBr04RlPa39+XqMs5FQVGspWEoUfyxHynOxUGX5fgwYCfeDMzMzV0hxFOjjKL/jwzQDUDXDMK8xaRfED6RaQ0OztbgUK0wlgjHDYiuleQN8kGdQjgJWa8ERPShEybEUjzoZ8E+vA+lF7DaBMRHL6Bs4fEA256pN2Kt2bItGA4WpBJixjyPwlpiL8Q2HgoDWruzG+DSHzEQ9/WZOAiyqZstVqZ0+lkDoeDdXZ2so6ODgJcLffhR2pm7Ek0fZIaGKP3WY7eBJhoIJJIPw0o0rinfwEP3Vesugk5lwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/42cd00819d1db5789826b38bb7f95328/a0b58/project.webp 230w,\n/static/42cd00819d1db5789826b38bb7f95328/2430e/project.webp 453w\" sizes=\"(max-width: 453px) 100vw, 453px\" type=\"image/webp\">\n        <source srcset=\"/static/42cd00819d1db5789826b38bb7f95328/81c8e/project.png 230w,\n/static/42cd00819d1db5789826b38bb7f95328/2108e/project.png 453w\" sizes=\"(max-width: 453px) 100vw, 453px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/42cd00819d1db5789826b38bb7f95328/2108e/project.png\" alt=\"Project evolution\" title=\"Project evolution\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n    </span><p>Dashed lines separate major differences across the course. Some exercises are not included in the picture. The connections between most pods are not included as well. You are free to do them however you want.</p><p>Keep this in mind if you want to avoid doing more work than necessary.</p><p>Let's get started!</p><p>Create a web server that outputs \"Server started in port NNNN\" when it is started and deploy it into your Kubernetes cluster. Please make it so that an environment variable PORT can be used to choose that port. You will not have access to the port when it is running in Kubernetes yet. We will configure the access when we get to networking.</p></exercise><h2 id=\"declarative-configuration-with-yaml\" style=\"position:relative;\">Declarative configuration with YAML<a href=\"#declarative-configuration-with-yaml\" aria-label=\"declarative configuration with yaml permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>We created the deployment with</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl create deployment hashgenerator-dep --image=jakousa/dwk-app1</code></pre></div><p>If we wanted to scale it 4 times and update the image:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl scale deployment/hashgenerator-dep --replicas=4\n\n$ kubectl set image deployment/hashgenerator-dep dwk-app1=jakousa/dwk-app1:b7fc18de2376da80ff0cfc72cf581a9f94d10e64</code></pre></div><p>Things start to get really cumbersome. It is hard to imagine how someone in their right mind could be maintaining multiple applications like that. Thankfully we will now use a <em>declarative</em> approach where we define how things should be rather than how they should change. This is more sustainable in the long run than the imperative approach and will let us keep our sanity.</p><p>Before redoing the previous steps via the declarative approach, let's take the existing deployment down.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl delete deployment hashgenerator-dep\n  deployment.apps &quot;hashgenerator-dep&quot; deleted</code></pre></div><p>and create a new folder named <code class=\"language-text\">manifests</code> and place a file called deployment.yaml with the following contents (you can check the example <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app1\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>) there:</p><p><strong>deployment.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hashgenerator<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> hashgenerator\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> hashgenerator\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hashgenerator\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jakousa/dwk<span class=\"token punctuation\">-</span>app1<span class=\"token punctuation\">:</span>b7fc18de2376da80ff0cfc72cf581a9f94d10e64</code></pre></div><text-box name=\"Text editor of choice\" variant=\"hint\">\n  I personally use Visual studio code to create these yaml files. It has helpful autofill, definitions, and syntax check for Kubernetes with the extension Kubernetes by Microsoft. Even now it helpfully warns us that we haven't defined resource limitations. I won't care about that warning yet, but you can figure it out if you want to.\n</text-box><p>This looks a lot like the docker-compose.yaml files we have previously written. Let's ignore what we don't know for now, which is mainly labels, and focus on the things that we know:</p><ul>\n<li>We're declaring what kind it is (kind: Deployment)</li>\n<li>We're declaring it a name as metadata (name: hashgenerator-dep)</li>\n<li>We're declaring that there should be one of them (replicas: 1)</li>\n<li>We're declaring that it has a container that is from a certain image with a name</li>\n</ul><p>Apply the deployment with <code class=\"language-text\">apply</code> command:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl apply -f manifests/deployment.yaml\n  deployment.apps/hashgenerator-dep created</code></pre></div><p>That's it, but for the sake of revision, let's delete it and create it again:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl delete -f manifests/deployment.yaml\n  deployment.apps &quot;hashgenerator-dep&quot; deleted\n\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app1/manifests/deployment.yaml\n  deployment.apps/hashgenerator-dep created</code></pre></div><p>Woah! The fact that you can apply manifest from the internet just like that will come in handy.</p><p>Instead of deleting the deployment, we could just apply a modified deployment on top of what we already have. Kubernetes will take care of rolling out a new version. By using tags (e.g. <code class=\"language-text\">dwk/image:tag</code>) in the deployments, each time we update the image we can modify and apply the new deployment yaml. Previously you may have always used the 'latest' tag, or not thought about tags at all. From the tag Kubernetes will know that the image is a new one and pulls it.</p><p>When updating anything in Kubernetes the usage of delete is actually an anti-pattern and you should use it only as the last option. As long as you don't delete the resource Kubernetes will do a rolling update, ensuring minimum (or none) downtime for the application. On the topic of anti-patterns: you should also always avoid doing anything imperatively! If your files don't tell Kubernetes and your team what the state should be and instead you run commands that edit the state you are just lowering the <a href=\"https://en.wikipedia.org/wiki/Bus_factor\" target=\"_blank\" rel=\"noopener noreferrer\">bus factor</a> for your cluster and application.</p><exercise name='Exercise 1.03: Declarative approach'><p>In your \"Log output\" application create the folder for manifests and move your deployment into a declarative file.</p><p>Make sure everything still works by restarting and following logs.</p></exercise><exercise name='Exercise 1.04: Project v0.2'><p>Create a deployment.yaml for the project.</p><p>You won't have access to the port yet but that'll come soon.</p></exercise><p>Note applying a new deployment won't update the application unless the tag is updated. You will not need to delete the deployment if you always come up with a new tag.</p><p>Your basic workflow may look something like this:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker build -t &lt;image&gt;:&lt;new_tag&gt;\n\n$ docker push &lt;image&gt;:&lt;new_tag&gt;</code></pre></div><p>Then edit deployment.yaml so that the tag is updated to the &#x3C;new_tag> and</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl apply -f manifests/deployment.yaml</code></pre></div></div>","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"},"fileAbsolutePath":"/home/runner/work/kubernetes-hy.github.io/kubernetes-hy.github.io/data/part-1/1-first-deploy.md"},"allPages":{"edges":[{"node":{"id":"e4e5fe1c-25b1-57b3-87eb-e204e767a49c","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"9f6e26aa-46a9-523d-96e4-a57c65ec083d","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"ecaa7011-87db-5ece-9b3c-1cfad638324a","frontmatter":{"path":"/","title":"Homepage"}}},{"node":{"id":"57c61ed7-37c4-5d0f-acd8-1dca0de6be4a","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"fb4fb717-329a-5d49-94c3-183aa16507e2","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"8ecc11b1-3298-589e-b97a-2a3a36861b8d","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"3d7eac33-2990-59d1-a002-64e0b0f4f370","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"dab4b6a7-96cf-5efe-83f4-f5199c283e65","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"78948204-39a7-5f81-b9f4-3029400d5f82","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"0b237cfb-5f2a-5d8e-9aa0-0cf9b045db3a","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"fe4a80ee-85ba-536e-bbf5-c5695399f40f","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"19841be9-897c-577a-9f82-5a7381bc073c","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"9e4ff8d0-2e6c-5d55-83a0-16ada460096d","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"56f2a7a2-c9e2-5bbb-b6a7-76fd46592c69","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"b810e0d9-0ac2-5073-a9dc-4ffd6649b7f7","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"f802a4ea-8d5a-503f-ad7b-d0138ab84c80","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"40440141-c1a8-5723-858a-eea86119b5b6","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"708df9d2-30d1-518f-8066-80109a75c4dc","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"47a288aa-ece4-5ba6-ab6e-cbc63dbdc752","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"c8b1eb5e-3c98-59b3-b6e9-6173791d7e34","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"471982cb-da12-5799-a6b2-fa8a3e67aa0d","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"7bebb01b-c990-5e7e-a9aa-d60f10ba63dd","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"e4c53dca-867f-5293-9b28-657b695cd3f3","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"fd6ebeaa-c808-5f11-9bdc-30e4f69b8a2a","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"0353d158-f751-57fd-94ce-373924da1b05","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"eae6660d-1d18-527a-bc1c-0f2f7ab54c6d","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"e80b74e8-a23b-5d3c-808b-833a72ac739c","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"9f3c6f02-668a-517b-b7b6-1828f74c7200","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"78f84327-bd7b-5b5d-941d-9fae8bca88d3","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"0a2d8cfd-8e40-59a7-a688-e8bdc9fb9e3a","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"8a2e40fa-1703-5755-aa66-ac69bf2e291d","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"a899eeb2-4329-5c9b-aadf-2fb803fa9142","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"39fb03b7-2abe-515a-a543-b812fcbfdba5","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"cbd58376-8d52-5297-b38d-653179a1226f","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"f5314214-d779-5fb4-a19f-ab7442f3fbb2","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"33c86b5c-3684-5006-b4e7-dbd0c7cc04bc","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"da15a80e-5316-5986-afcf-75d521065017","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}