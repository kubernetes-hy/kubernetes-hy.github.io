{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-4/3-gitops","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Learning Objectives"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After this section, you can"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"compare GitOps to other deployment methods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"compare traditional push deployment to a pull deployment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"implement GitOps in your Kubernetes cluster"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"An average simple deployment pipeline we have used and learned about is something like this."}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Developer runs git push with modified code. E.g. to GitHub"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"This triggers a CI/CD service to start running. E.g. to GitHub actions"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD service runs tests, builds an image, pushes the image to a registry and deploys the new image. E.g. to Kubernetes"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is called a push deployment. It is a descriptive name as everything is pushed forward by the previous step. There are some challenges with the push approach. For example, if we have a Kubernetes cluster that is unavailable for external connections i.e. the cluster on your local machine or any cluster we don't want to give outsiders access to. In those cases having CI/CD push the update to the cluster is not possible."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In a pull configuration the setup is reversed. We can have the cluster, running anywhere, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"pull"}]},{"type":"text","value":" the new image and deploy it automatically. The new image will still be tested and built by the CI/CD. We simply relieve the CI/CD of the burden of deployment and move it to another system that is doing the pulling."}]},{"type":"element","tagName":"text-box","properties":{"name":"Watchtower","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you completed DevOps with Docker you may have heard about "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/containrrr/watchtower","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"watchtower"}]},{"type":"text","value":" which enabled us to change the last pushes of a deployment pipeline to pulls when running services with docker-compose."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"GitOps is all about this reversal and promotes good practices for the operations side of things. This is achieved by having the state of the cluster be in a git repository. So besides handling the application deployment it will handle all changes to the cluster. This will require some additional configuration and rethinking past the tradition of server configuration. But when we get there GitOps will be the final nail in the coffin of imperative cluster management."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ArgoCD"}]},{"type":"text","value":" is the tool of choice. At the end our workflow should look like this:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Developer runs git push with modified code or configurations."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD service (GitHub Actions in our case) starts running."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD service builds and pushes new image "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"and"}]},{"type":"text","value":" commits edit to the \"release\" branch (main in our case)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ArgoCD will take the state described in the release branch and set it as the state of our cluster."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us start by installing ArgoCD by following the "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Detting started"}]},{"type":"text","value":" of the docs:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now ArgoCD is up and running in our cluster. We still need to open access to it. There are several "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#3-access-the-argo-cd-api-server","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"optins"}]},{"type":"text","value":". We shall use the LoadBalancer. So we'll give the command"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl patch svc argocd-server -n argocd -p "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'{\"spec\": {\"type\": \"LoadBalancer\"}}'"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After a short wait, the cluster has provided us with an external IP:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ kubectl get svc -n argocd\nNAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"S"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"                      AGE\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\nargocd-server      LoadBalancer   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.7"}]},{"type":"text","value":".5.82     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"34.88"}]},{"type":"text","value":".152.2   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":":32029/TCP,443:30574/TCP   17min"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The initial password for the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"admin"}]},{"type":"text","value":" account is auto-generated and stored as clear text in the field password in a secret named "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"argocd-initial-admin-secret"}]},{"type":"text","value":" in your Argo CD installation namespace. So we get it by base64 decoding the value that we get with the command"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl get -n argocd secrets argocd-initial-admin-secret -o yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can now login:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz3WQyW/TUBDGfQEEBygHDiBo1aKyFhVIN5VWUA4oJxD0xHbkX0O9UJWiilCFCLWBInDI5sRbnl/sZzveEjuLRIlrYBIjX3Ct32H0zftmvjHFIcwyLFdisIAszSKapek20Gz1ur1+Z8Cvdjceaj75JJFcHbk6l3z+quW1O91eEAS+f+AfDOj3/b7v//4T/1EXE8tjsytHLly7+/jF9s7XtXfbW5ns67epN+8zm+kdKNZTmZ/7+/D0/xHU+VvLk4sPTkxMr6y+9Do9YliybqiGbbttx22bTU+FfEEQv3l87j5sPjY2tfTomeZ4xHZls0ksF2pABcXxJN3m6zpf15BqDnU3hBqduXd2+s7x8RuLD5/WNAvpdgjUQ2xeMXIs+sHhPIdpVqpgLepSZ6YWzt1cOjl5G8yRM0JqOGVEKogwiJREmcVqSVSiLgW2kcszR0evH2au1jXYCZkheVGowywQ/5lPXUqcvjILNx9mBoqinGMlGJHnMaQNxXgz3BnaaqopDgED7IfkAjGhJWoWiPAgfrOoWpzcyHNor1DdK7IFXmKQkmNrRQHTFeFbmaerIq804s0CMeBduaYUeMxI5MNnem3rI7CR3oXfBjrMqkgkNvbgKmw0Q2Sr9YkubaSzm5kvqex3yYhazl/MZlHVn92WAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9960d78be7b36c3c387923af1cf4accc/a0b58/argo2.webp 230w","/static/9960d78be7b36c3c387923af1cf4accc/bc10c/argo2.webp 460w","/static/9960d78be7b36c3c387923af1cf4accc/966d8/argo2.webp 920w","/static/9960d78be7b36c3c387923af1cf4accc/445df/argo2.webp 1380w","/static/9960d78be7b36c3c387923af1cf4accc/78de1/argo2.webp 1840w","/static/9960d78be7b36c3c387923af1cf4accc/882b9/argo2.webp 1920w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9960d78be7b36c3c387923af1cf4accc/81c8e/argo2.png 230w","/static/9960d78be7b36c3c387923af1cf4accc/08a84/argo2.png 460w","/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png 920w","/static/9960d78be7b36c3c387923af1cf4accc/b1001/argo2.png 1380w","/static/9960d78be7b36c3c387923af1cf4accc/161ec/argo2.png 1840w","/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png 1920w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png","alt":"argo2","title":"argo2","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us now deploy the simple app in "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mluukkai/dwk-app1","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/mluukkai/dwk-app1"}]},{"type":"text","value":" using ArgoCD. We start by clicking "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"New app"}]},{"type":"text","value":" and fill the form that opens:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQY052RwQ6CMAyG9/4vxJmLwYuEBGLUePAqMVkGKyu0qx0arw6+/Lf+X5qmZkLEeVmI/kZbUaTurkV5qOrWDt6MAGpLBjGqK5f7ozyemvPNeTDWuoAzc5rk5McAkyFiTmouWl8Ndio/+1cIKNtJctzHRx497Nis+lfWH+jRm0LrzW/UEtdBMoJwxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/5725dd9e9f90f4f0bdc37eb1e7024813/a0b58/argo3.webp 230w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/bc10c/argo3.webp 460w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/966d8/argo3.webp 920w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/445df/argo3.webp 1380w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/ffcc2/argo3.webp 1826w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/5725dd9e9f90f4f0bdc37eb1e7024813/81c8e/argo3.png 230w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/08a84/argo3.png 460w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png 920w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/b1001/argo3.png 1380w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png 1826w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png","alt":"argo3","title":"argo3","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At the start, we decided to have a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"manual sync policy"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 82.17391304347825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQoz51Syw6DMAzj//9wdw47MEZL00eSlrkwJHZgo7OMBFLdGMddYvEhas5LI1i0g5jIgyLCzAnfomeCUpa8j6nimBhKY2dHZOd5MpZ8KCeAEneXg1j8evqi27wCL0mkiyxudqqacfHOL5NDiMxSxSz1n3N7WntgSOHW5/tYah5XgbPVdoLfyWk/HG3/ZIEYti0FEgFdiE20PnRbSagl8I+SJMSn+k9gKMlzMuNzQj3woGHLeXLYS4xp8/ieXAupejnnz8nDY+S1zzXE3zyuaq1LacSyrco4ss7/QeP8C3XusNVNcFqcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/048907e8118485b948585dd05b0b3741/a0b58/argo4.webp 230w","/static/048907e8118485b948585dd05b0b3741/bc10c/argo4.webp 460w","/static/048907e8118485b948585dd05b0b3741/966d8/argo4.webp 920w","/static/048907e8118485b948585dd05b0b3741/445df/argo4.webp 1380w","/static/048907e8118485b948585dd05b0b3741/2c1a7/argo4.webp 1832w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/048907e8118485b948585dd05b0b3741/81c8e/argo4.png 230w","/static/048907e8118485b948585dd05b0b3741/08a84/argo4.png 460w","/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png 920w","/static/048907e8118485b948585dd05b0b3741/b1001/argo4.png 1380w","/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png 1832w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png","alt":"argo4","title":"argo4","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that since the definition (in our case file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":") is in the repository root, we have defined the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"path"}]},{"type":"text","value":" to having the value ., that is, the character "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"period"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The app is created but is is missing and not in sync, since we selected the manual sync policy:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 55.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz22RbW/SUBTH+wU2TcoAs+FeiBBXnkqDK1AYc5ku8Y3fUd/NqDPZ5sPQ0CVEETInkbi5YYZEGJXC2tLb3nvLPNsSgujJPyc3N/md/3lgorkHXHaNyz2cDsTn+Gy1dqDrBiZkOBw6jnOVKb14nP8TTPbe6kJqJZhZm74dvynknm3nn7zYfrkjr2/lHz/f2nhbWN/cgZ+NN4WrAsOxYFh/dDYmBVL33aGkOyRWD44bbeXopHn4o1FvtlqK2mwrP1uduqJi6kw6+3jJJyzNJ5avBQQXl9z/+gVZVk8zBsjClNqEWphARtSBbNq20tdHYmKrjwD2hJNTfp7lUqVKoacq7dPfMLaN8YQVVPze7IzEAOmNSrN8xhMWL+FdhPQz3Tx37H5P0bXumaZBFUopwNDF8S9lJOZ6UJjhoGGRvZNwcelSRbYtQ+n2Mba6qqobmqYbumEOBiYsaxL2RhZvJURPRIJtzYSkj+UCJRZMDBcil27jYWH8F3wjKs3xOXCe8sfcYYBlSlCvrwEMnnAPQijMD/pP22w46U2vzMeXoH93JFPe2z3ttN8Vy9VvR5Vqbb92CMtHyDJNBLBNyITzYjAt+oRlduGuK5Qq7xXrjZOnr96/lj/ki5/k0mcbTCmYX0g30Tj8B75h5RCeBB0BAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42257e4e900ba4b6ce44a953ffebf40e/a0b58/argo5.webp 230w","/static/42257e4e900ba4b6ce44a953ffebf40e/bc10c/argo5.webp 460w","/static/42257e4e900ba4b6ce44a953ffebf40e/966d8/argo5.webp 920w","/static/42257e4e900ba4b6ce44a953ffebf40e/445df/argo5.webp 1380w","/static/42257e4e900ba4b6ce44a953ffebf40e/eaa3b/argo5.webp 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42257e4e900ba4b6ce44a953ffebf40e/81c8e/argo5.png 230w","/static/42257e4e900ba4b6ce44a953ffebf40e/08a84/argo5.png 460w","/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png 920w","/static/42257e4e900ba4b6ce44a953ffebf40e/b1001/argo5.png 1380w","/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png","alt":"argo5","title":"argo5","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us sync it and go to the app page:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 33.04347826086957%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVQY022P2W7EIAxF8/8fV1WV2ofJ2ixsNhhCyD5K3Zn2qUXnARtzOWSALi5Lg4DWjcc6Hdt1XbTOlUe/pLgu53ne7/frv5Wt+74dhx+j0IA+jGnej3PeNu2oVwbJhykt68bNv2RunGhM2vpGYSWgUrYU8ITLRtlK4k8pf3kc8SYrBsh7wxSD4YlaQi3gU9tWOy5bbTkXaPRx7oF4mJuFxuIRlwnr7ZiYDqiW2KOTRDEtyvlKmFqweXA+hmnhoOf79a2ti64UJuusxzBpF55KHbgByVBUFDirHLQNMcQU0yzR5wJyhc1rXhhbUmBtc+s1w0r8vdZYYQl9bDV+XxaG1SRSwxYSbsJ8aHzX8NKKt0F/AUPAg10f8YnVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cd87037fd1633913045859e928ab140/a0b58/argo6.webp 230w","/static/6cd87037fd1633913045859e928ab140/bc10c/argo6.webp 460w","/static/6cd87037fd1633913045859e928ab140/966d8/argo6.webp 920w","/static/6cd87037fd1633913045859e928ab140/445df/argo6.webp 1380w","/static/6cd87037fd1633913045859e928ab140/78de1/argo6.webp 1840w","/static/6cd87037fd1633913045859e928ab140/05d2a/argo6.webp 2780w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cd87037fd1633913045859e928ab140/81c8e/argo6.png 230w","/static/6cd87037fd1633913045859e928ab140/08a84/argo6.png 460w","/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png 920w","/static/6cd87037fd1633913045859e928ab140/b1001/argo6.png 1380w","/static/6cd87037fd1633913045859e928ab140/161ec/argo6.png 1840w","/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png 2780w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png","alt":"argo6","title":"argo6","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Something seems to be wrong, the pod has a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"broken heart"}]},{"type":"text","value":" symbol. We could now start our usual debugging process starging with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get po"}]},{"type":"text","value":". We see the same info from ArgoCD by clicking the pod:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 20.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI13VOWw6AIAzj/oc1ytgLNrRqTPix6cearI/i7qp2LoDctl1Ucc8H5w9KRFBjc1/MyqIiclTaj+reI7L3AcaHzLzNY4xKxCz5lszpvefTJmp3EAuIFFA+qWZ4LuiEWJcNVUIe9jBTa8j6m30BDr3q3RWpfRUAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/8137a058e3e08723c19a069a11382d75/a0b58/argo7.webp 230w","/static/8137a058e3e08723c19a069a11382d75/bc10c/argo7.webp 460w","/static/8137a058e3e08723c19a069a11382d75/966d8/argo7.webp 920w","/static/8137a058e3e08723c19a069a11382d75/445df/argo7.webp 1380w","/static/8137a058e3e08723c19a069a11382d75/78de1/argo7.webp 1840w","/static/8137a058e3e08723c19a069a11382d75/cb61f/argo7.webp 1936w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/8137a058e3e08723c19a069a11382d75/81c8e/argo7.png 230w","/static/8137a058e3e08723c19a069a11382d75/08a84/argo7.png 460w","/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png 920w","/static/8137a058e3e08723c19a069a11382d75/b1001/argo7.png 1380w","/static/8137a058e3e08723c19a069a11382d75/161ec/argo7.png 1840w","/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png 1936w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png","alt":"argo7","title":"argo7","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, we have specified a image that does not exist. Let us fix it in GitHub by changing "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":" as follows:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" mluukkai/dwk1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we sync the changes in ArgoCD, a new healthy pod is started and our app is up and running!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can check the external IP either from command line with "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kubectl"}]},{"type":"text","value":" or clicking the service:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 57.391304347826086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz4VQAW6DMAzk/3/bCyZ1WrcJOgYmiePESZzOQKm6ibanEyImd4ev6cF+D9D149fpR/kBAEgWCZx/ymZCOoE5fLbHrgcMYPHYD+9gB4vjMzZq0CN1xrXGTRQxsEEygT0nfX/MxvogIjml8w1yzsx/Jru4iCOzHqpCnyouhZljLrIc73EWFxGHWEpZR4qU82TsSEG2kLtiTR4ng97XumafU0qDw6h2Imqq7nUPFzF6ul1S78cYPQVK7ENw6FfT3Z1rXArbkmvOxTjkyHWw4mPdPu0nw/zbdN1Z2xoR41tbX17lcWHqoQ0l7bbWlbqkFl6Wtmdu83/8BQAWgkrmLrCcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/a0b58/argo8.webp 230w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/bc10c/argo8.webp 460w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/966d8/argo8.webp 920w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/445df/argo8.webp 1380w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/9d85b/argo8.webp 1720w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/81c8e/argo8.png 230w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/08a84/argo8.png 460w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png 920w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/b1001/argo8.png 1380w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png 1720w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png","alt":"argo8","title":"argo8","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us now change the sync mode to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"automatic"}]},{"type":"text","value":" by clicking the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Details"}]},{"type":"text","value":" from the app page in ArgoCD."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now all the configuration changes that we make to GitHub should be automatically applied by ArgoCD. Let us scale up the deployment to have 5 pods:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"..."}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After a small wait (the default sync frequency of ArgoCD is 180 seconds), app gets synchronized and 5 pods are up and running:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz3VQy1LDMAzM/38Xd2BCSYc8CKkfsSXLTuw2DWkblHJghgHNHjQrrbRSJrwbYlKjpxCO12W6XdZ1NccoY0jLPF8vN47178jmy/K5LCElcDSkNM0zs3E6KUQ/jmNMXF7/E/sxpdOUjpMGEpYkeOVC74K85xswSPSCefTaBY13bInP2h4PlgRQq7FWUCmopS2FqTVWEt65apww1NPYWfcmbdFjoWEnzd66rGGNhFLaagPwIEnepxRP5wP4RgHwNWxtOvPCN2FyR/sx5hZ3FLKH58IMXD6HdGIXtbCNBnZRCVseDLvoepZHvk6B38TWvVLIe9ix7X2rPnonrW+4uzMd+wRnKfjxyC4aCXwRq9Xd/CY2uEN6PGhOslY73vYNbm0VdMbxnziphflQyH+iEJXFzmAp7AtQ4YdH2efAN0v4BZ5SbbN+mHeF33wpIUcqwvCkTQ70BazU8IjWLkqtAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7a969076cce54007f1e967c1b9c6a1d6/a0b58/argo9.webp 230w","/static/7a969076cce54007f1e967c1b9c6a1d6/bc10c/argo9.webp 460w","/static/7a969076cce54007f1e967c1b9c6a1d6/966d8/argo9.webp 920w","/static/7a969076cce54007f1e967c1b9c6a1d6/445df/argo9.webp 1380w","/static/7a969076cce54007f1e967c1b9c6a1d6/78de1/argo9.webp 1840w","/static/7a969076cce54007f1e967c1b9c6a1d6/96199/argo9.webp 2764w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7a969076cce54007f1e967c1b9c6a1d6/81c8e/argo9.png 230w","/static/7a969076cce54007f1e967c1b9c6a1d6/08a84/argo9.png 460w","/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png 920w","/static/7a969076cce54007f1e967c1b9c6a1d6/b1001/argo9.png 1380w","/static/7a969076cce54007f1e967c1b9c6a1d6/161ec/argo9.png 1840w","/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png 2764w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png","alt":"argo9","title":"argo9","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Besides services, deployments and pods, the app configuration tree shows also some other objects. We see that there is a\n"},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ReplicaSet"}]},{"type":"text","value":" (in figure "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"rs"}]},{"type":"text","value":") in between deployment and the pods. A ReplicaSet is a Kubernetes object that ensures there is always a stable set of running pods for a specific workload. The ReplicaSet configuration defines a number of identical pods required, and if a pod is evicted or fails, creates more pods to compensate for the loss. Users do not usually define ReplicaSets directly, instead Deployments are used. A Deployment then creates a ReplicaSet that takes care of running the pod replicas."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The changes in app Kubernetes configurations that we make to GitHub are now nicely synched to the cluster. How about the changes in the app?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In order to deploy a new app version, we should change the image that is used in the deployment. Currently the image is defined in the file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" mluukkai/dwk1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So to deploy a new the app, we should"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"create a new image with possibly a new tag"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"change the kustomization.yaml to use the new image"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"push changes to GitHub"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Surely this could be done manually but that is not enough for us. Let us now define a GitHub Actions workflow that does all these steps."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first step is already familiar to us from "},{"type":"element","tagName":"a","properties":{"href":"/part-3/2-deployment-pipeline"},"children":[{"type":"text","value":"part 3"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The step 2 can be done with the command "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomize edit"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"$ kustomize edit set image PROJECT/IMAGE=node"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"20"}]},{"type":"text","value":"\n$ cat kustomization.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" node\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newTag"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"20\""}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As we see, the command "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"changes"}]},{"type":"text","value":" the file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":". So all that is left is to commit the file to the repository. Fortunately there is a ready made GitHub Action "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/EndBug/add-and-commit","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"add-and-commit"}]},{"type":"text","value":" for that!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The workflow looks the following:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and publish application\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build-publish"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Push"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Release\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"runs-on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ubuntu"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"steps"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Checkout\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" actions/checkout@v4\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Login to Docker Hub\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/login"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v3\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"username"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_USERNAME "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"password"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_TOKEN "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# tag image with the GitHub SHA to get a unique tag"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and publish backend\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"run"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n          docker build "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"tag \"mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\" .\n          docker push \"mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Set up Kustomize\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" imranismail/setup"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"kustomize@v2\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Use right image\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"run"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize edit set image PROJECT/IMAGE=mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" commit kustomization.yaml to GitHub\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" EndBug/add"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"and"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"commit@v9\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"add"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'kustomization.yaml'"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"message"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" New version released $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" github.sha "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is still one more to do, from the repository settings we must give the GitHub Actions permission to write to our repository:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY042QaY6EIBSEvf/p5gC27QIogkALGmWdsk0m/pzKBym29ypUhAk2LWyUmPth6oaJTUrpbbWndf7JepstaLNzYU6lqgilFEvxMVLK2DhhYN73HSchRB+C9yEGD+BSvLz3JzarAoVYtI3GtXQkA2m7ruv7fhgmzhkdUYsQ1nPzHk1NlpqaF4XX27ZVJeekbf5pQi8brl51/W67pmkJZeazGvNR2rht348Qc7kCpgt46Nu5lK8vzjkEnmc5C8m5oGwcJw5Wa4/jOE9w5nzf/XuMdUKAjD5CiPlC4tOkXICQEiwK0lobjTzrepeoykN8luh1XV0UEEKiFpbYuP7soUfnO3nO1m0p5fJv/QLGgMjXxrD94AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/099030fe16625510838386413508f6e5/a0b58/gha-perm.webp 230w","/static/099030fe16625510838386413508f6e5/bc10c/gha-perm.webp 460w","/static/099030fe16625510838386413508f6e5/966d8/gha-perm.webp 920w","/static/099030fe16625510838386413508f6e5/445df/gha-perm.webp 1380w","/static/099030fe16625510838386413508f6e5/78de1/gha-perm.webp 1840w","/static/099030fe16625510838386413508f6e5/eb397/gha-perm.webp 1894w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/099030fe16625510838386413508f6e5/81c8e/gha-perm.png 230w","/static/099030fe16625510838386413508f6e5/08a84/gha-perm.png 460w","/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png 920w","/static/099030fe16625510838386413508f6e5/b1001/gha-perm.png 1380w","/static/099030fe16625510838386413508f6e5/161ec/gha-perm.png 1840w","/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png 1894w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png","alt":"gha perm","title":"gha perm","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We are now set, all changes to configurations and to the app code are now deployed automatically by ArcoCD with the help of our GitHub Action workflow, so nice!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With GitOps we achieve the following:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Better security"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nobody needs access to the cluster, not even CI/CD services. No need to share access to the cluster with collaborators; they will commit changes like everyone else."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Better transparency"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Everything is declared in the GitHub repository. When a new person joins the team they can check the repository; no need to pass ancient knowledge or hidden techniques as there are none."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Better traceability"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"All changes to the cluster are version-controlled. You will know exactly what was the state of the cluster and how it was changed and by whom."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Risk reduction"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If something breaks simply revert the cluster to a working commit. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git revert"}]},{"type":"text","value":" and the whole cluster is in a previous state."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Portability"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Want to change to a new provider? Spin up a cluster and point it to the same repository - your cluster is now there."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are a few options for the GitOps setup. What we used here was having the configuration for the application in the same repository as the application itself. Another option is to have the configuration separate from the source code. That approach also removes the risk of having a pipeline loop where your pipeline commits to the repository which then triggers the pipeline..."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 4.07: GitOps the Project"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  Move The Project to use GitOps so that when you commit to the repository, the application is automatically updated."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The next one is still to be specified:"}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 4.08: Moar GitOps"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"eg:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  Move your cluster configuration to GitOps."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  Validate that everything works by deleting the cluster "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k3d cluster delete"}]},{"type":"text","value":" and recreating it by bootstrapping with ArcoCD."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"or:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  prod and staging with overlays"}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Learning Objectives'><p>After this section, you can</p><ul>\n<li>compare GitOps to other deployment methods</li>\n<li>compare traditional push deployment to a pull deployment</li>\n<li>implement GitOps in your Kubernetes cluster</li>\n</ul></text-box><p>An average simple deployment pipeline we have used and learned about is something like this.</p><ol>\n<li>Developer runs git push with modified code. E.g. to GitHub</li>\n<li>This triggers a CI/CD service to start running. E.g. to GitHub actions</li>\n<li>CI/CD service runs tests, builds an image, pushes the image to a registry and deploys the new image. E.g. to Kubernetes</li>\n</ol><p>This is called a push deployment. It is a descriptive name as everything is pushed forward by the previous step. There are some challenges with the push approach. For example, if we have a Kubernetes cluster that is unavailable for external connections i.e. the cluster on your local machine or any cluster we don't want to give outsiders access to. In those cases having CI/CD push the update to the cluster is not possible.</p><p>In a pull configuration the setup is reversed. We can have the cluster, running anywhere, <strong>pull</strong> the new image and deploy it automatically. The new image will still be tested and built by the CI/CD. We simply relieve the CI/CD of the burden of deployment and move it to another system that is doing the pulling.</p><text-box name=\"Watchtower\" variant=\"hint\"><p>If you completed DevOps with Docker you may have heard about <a href=\"https://github.com/containrrr/watchtower\" target=\"_blank\" rel=\"noopener noreferrer\">watchtower</a> which enabled us to change the last pushes of a deployment pipeline to pulls when running services with docker-compose.</p></text-box><p>GitOps is all about this reversal and promotes good practices for the operations side of things. This is achieved by having the state of the cluster be in a git repository. So besides handling the application deployment it will handle all changes to the cluster. This will require some additional configuration and rethinking past the tradition of server configuration. But when we get there GitOps will be the final nail in the coffin of imperative cluster management.</p><p><a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">ArgoCD</a> is the tool of choice. At the end our workflow should look like this:</p><ol>\n<li>Developer runs git push with modified code or configurations.</li>\n<li>CI/CD service (GitHub Actions in our case) starts running.</li>\n<li>CI/CD service builds and pushes new image <em>and</em> commits edit to the \"release\" branch (main in our case)</li>\n<li>ArgoCD will take the state described in the release branch and set it as the state of our cluster.</li>\n</ol><p>Let us start by installing ArgoCD by following the <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/\" target=\"_blank\" rel=\"noopener noreferrer\">Detting started</a> of the docs:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code></pre></div><p>Now ArgoCD is up and running in our cluster. We still need to open access to it. There are several <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#3-access-the-argo-cd-api-server\" target=\"_blank\" rel=\"noopener noreferrer\">optins</a>. We shall use the LoadBalancer. So we'll give the command</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl patch svc argocd-server -n argocd -p <span class=\"token string\">'{\"spec\": {\"type\": \"LoadBalancer\"}}'</span></code></pre></div><p>After a short wait, the cluster has provided us with an external IP:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl get svc -n argocd\nNAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>                      AGE\n<span class=\"token punctuation\">..</span>.\nargocd-server      LoadBalancer   <span class=\"token number\">10.7</span>.5.82     <span class=\"token number\">34.88</span>.152.2   <span class=\"token number\">80</span>:32029/TCP,443:30574/TCP   17min</code></pre></div><p>The initial password for the <em>admin</em> account is auto-generated and stored as clear text in the field password in a secret named <em>argocd-initial-admin-secret</em> in your Argo CD installation namespace. So we get it by base64 decoding the value that we get with the command</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get -n argocd secrets argocd-initial-admin-secret -o yaml</code></pre></div><p>We can now login:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz3WQyW/TUBDGfQEEBygHDiBo1aKyFhVIN5VWUA4oJxD0xHbkX0O9UJWiilCFCLWBInDI5sRbnl/sZzveEjuLRIlrYBIjX3Ct32H0zftmvjHFIcwyLFdisIAszSKapek20Gz1ur1+Z8Cvdjceaj75JJFcHbk6l3z+quW1O91eEAS+f+AfDOj3/b7v//4T/1EXE8tjsytHLly7+/jF9s7XtXfbW5ns67epN+8zm+kdKNZTmZ/7+/D0/xHU+VvLk4sPTkxMr6y+9Do9YliybqiGbbttx22bTU+FfEEQv3l87j5sPjY2tfTomeZ4xHZls0ksF2pABcXxJN3m6zpf15BqDnU3hBqduXd2+s7x8RuLD5/WNAvpdgjUQ2xeMXIs+sHhPIdpVqpgLepSZ6YWzt1cOjl5G8yRM0JqOGVEKogwiJREmcVqSVSiLgW2kcszR0evH2au1jXYCZkheVGowywQ/5lPXUqcvjILNx9mBoqinGMlGJHnMaQNxXgz3BnaaqopDgED7IfkAjGhJWoWiPAgfrOoWpzcyHNor1DdK7IFXmKQkmNrRQHTFeFbmaerIq804s0CMeBduaYUeMxI5MNnem3rI7CR3oXfBjrMqkgkNvbgKmw0Q2Sr9YkubaSzm5kvqex3yYhazl/MZlHVn92WAAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/9960d78be7b36c3c387923af1cf4accc/a0b58/argo2.webp 230w,\n/static/9960d78be7b36c3c387923af1cf4accc/bc10c/argo2.webp 460w,\n/static/9960d78be7b36c3c387923af1cf4accc/966d8/argo2.webp 920w,\n/static/9960d78be7b36c3c387923af1cf4accc/445df/argo2.webp 1380w,\n/static/9960d78be7b36c3c387923af1cf4accc/78de1/argo2.webp 1840w,\n/static/9960d78be7b36c3c387923af1cf4accc/882b9/argo2.webp 1920w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/9960d78be7b36c3c387923af1cf4accc/81c8e/argo2.png 230w,\n/static/9960d78be7b36c3c387923af1cf4accc/08a84/argo2.png 460w,\n/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png 920w,\n/static/9960d78be7b36c3c387923af1cf4accc/b1001/argo2.png 1380w,\n/static/9960d78be7b36c3c387923af1cf4accc/161ec/argo2.png 1840w,\n/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png 1920w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png\" alt=\"argo2\" title=\"argo2\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Let us now deploy the simple app in <a href=\"https://github.com/mluukkai/dwk-app1\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/mluukkai/dwk-app1</a> using ArgoCD. We start by clicking <em>New app</em> and fill the form that opens:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQY052RwQ6CMAyG9/4vxJmLwYuEBGLUePAqMVkGKyu0qx0arw6+/Lf+X5qmZkLEeVmI/kZbUaTurkV5qOrWDt6MAGpLBjGqK5f7ozyemvPNeTDWuoAzc5rk5McAkyFiTmouWl8Ndio/+1cIKNtJctzHRx497Nis+lfWH+jRm0LrzW/UEtdBMoJwxAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/a0b58/argo3.webp 230w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/bc10c/argo3.webp 460w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/966d8/argo3.webp 920w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/445df/argo3.webp 1380w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/ffcc2/argo3.webp 1826w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/81c8e/argo3.png 230w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/08a84/argo3.png 460w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png 920w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/b1001/argo3.png 1380w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png 1826w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png\" alt=\"argo3\" title=\"argo3\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>At the start, we decided to have a <em>manual sync policy</em>.</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 82.17391304347825%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQoz51Syw6DMAzj//9wdw47MEZL00eSlrkwJHZgo7OMBFLdGMddYvEhas5LI1i0g5jIgyLCzAnfomeCUpa8j6nimBhKY2dHZOd5MpZ8KCeAEneXg1j8evqi27wCL0mkiyxudqqacfHOL5NDiMxSxSz1n3N7WntgSOHW5/tYah5XgbPVdoLfyWk/HG3/ZIEYti0FEgFdiE20PnRbSagl8I+SJMSn+k9gKMlzMuNzQj3woGHLeXLYS4xp8/ieXAupejnnz8nDY+S1zzXE3zyuaq1LacSyrco4ss7/QeP8C3XusNVNcFqcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/048907e8118485b948585dd05b0b3741/a0b58/argo4.webp 230w,\n/static/048907e8118485b948585dd05b0b3741/bc10c/argo4.webp 460w,\n/static/048907e8118485b948585dd05b0b3741/966d8/argo4.webp 920w,\n/static/048907e8118485b948585dd05b0b3741/445df/argo4.webp 1380w,\n/static/048907e8118485b948585dd05b0b3741/2c1a7/argo4.webp 1832w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/048907e8118485b948585dd05b0b3741/81c8e/argo4.png 230w,\n/static/048907e8118485b948585dd05b0b3741/08a84/argo4.png 460w,\n/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png 920w,\n/static/048907e8118485b948585dd05b0b3741/b1001/argo4.png 1380w,\n/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png 1832w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png\" alt=\"argo4\" title=\"argo4\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Note that since the definition (in our case file <em>kustomization.yaml</em>) is in the repository root, we have defined the <em>path</em> to having the value ., that is, the character <em>period</em>.</p><p>The app is created but is is missing and not in sync, since we selected the manual sync policy:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz22RbW/SUBTH+wU2TcoAs+FeiBBXnkqDK1AYc5ku8Y3fUd/NqDPZ5sPQ0CVEETInkbi5YYZEGJXC2tLb3nvLPNsSgujJPyc3N/md/3lgorkHXHaNyz2cDsTn+Gy1dqDrBiZkOBw6jnOVKb14nP8TTPbe6kJqJZhZm74dvynknm3nn7zYfrkjr2/lHz/f2nhbWN/cgZ+NN4WrAsOxYFh/dDYmBVL33aGkOyRWD44bbeXopHn4o1FvtlqK2mwrP1uduqJi6kw6+3jJJyzNJ5avBQQXl9z/+gVZVk8zBsjClNqEWphARtSBbNq20tdHYmKrjwD2hJNTfp7lUqVKoacq7dPfMLaN8YQVVPze7IzEAOmNSrN8xhMWL+FdhPQz3Tx37H5P0bXumaZBFUopwNDF8S9lJOZ6UJjhoGGRvZNwcelSRbYtQ+n2Mba6qqobmqYbumEOBiYsaxL2RhZvJURPRIJtzYSkj+UCJRZMDBcil27jYWH8F3wjKs3xOXCe8sfcYYBlSlCvrwEMnnAPQijMD/pP22w46U2vzMeXoH93JFPe2z3ttN8Vy9VvR5Vqbb92CMtHyDJNBLBNyITzYjAt+oRlduGuK5Qq7xXrjZOnr96/lj/ki5/k0mcbTCmYX0g30Tj8B75h5RCeBB0BAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/42257e4e900ba4b6ce44a953ffebf40e/a0b58/argo5.webp 230w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/bc10c/argo5.webp 460w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/966d8/argo5.webp 920w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/445df/argo5.webp 1380w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/eaa3b/argo5.webp 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/42257e4e900ba4b6ce44a953ffebf40e/81c8e/argo5.png 230w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/08a84/argo5.png 460w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png 920w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/b1001/argo5.png 1380w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png\" alt=\"argo5\" title=\"argo5\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Let us sync it and go to the app page:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.04347826086957%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVQY022P2W7EIAxF8/8fV1WV2ofJ2ixsNhhCyD5K3Zn2qUXnARtzOWSALi5Lg4DWjcc6Hdt1XbTOlUe/pLgu53ne7/frv5Wt+74dhx+j0IA+jGnej3PeNu2oVwbJhykt68bNv2RunGhM2vpGYSWgUrYU8ITLRtlK4k8pf3kc8SYrBsh7wxSD4YlaQi3gU9tWOy5bbTkXaPRx7oF4mJuFxuIRlwnr7ZiYDqiW2KOTRDEtyvlKmFqweXA+hmnhoOf79a2ti64UJuusxzBpF55KHbgByVBUFDirHLQNMcQU0yzR5wJyhc1rXhhbUmBtc+s1w0r8vdZYYQl9bDV+XxaG1SRSwxYSbsJ8aHzX8NKKt0F/AUPAg10f8YnVAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/6cd87037fd1633913045859e928ab140/a0b58/argo6.webp 230w,\n/static/6cd87037fd1633913045859e928ab140/bc10c/argo6.webp 460w,\n/static/6cd87037fd1633913045859e928ab140/966d8/argo6.webp 920w,\n/static/6cd87037fd1633913045859e928ab140/445df/argo6.webp 1380w,\n/static/6cd87037fd1633913045859e928ab140/78de1/argo6.webp 1840w,\n/static/6cd87037fd1633913045859e928ab140/05d2a/argo6.webp 2780w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/6cd87037fd1633913045859e928ab140/81c8e/argo6.png 230w,\n/static/6cd87037fd1633913045859e928ab140/08a84/argo6.png 460w,\n/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png 920w,\n/static/6cd87037fd1633913045859e928ab140/b1001/argo6.png 1380w,\n/static/6cd87037fd1633913045859e928ab140/161ec/argo6.png 1840w,\n/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png 2780w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png\" alt=\"argo6\" title=\"argo6\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Something seems to be wrong, the pod has a <em>broken heart</em> symbol. We could now start our usual debugging process starging with <code class=\"language-text\">kubectl get po</code>. We see the same info from ArgoCD by clicking the pod:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI13VOWw6AIAzj/oc1ytgLNrRqTPix6cearI/i7qp2LoDctl1Ucc8H5w9KRFBjc1/MyqIiclTaj+reI7L3AcaHzLzNY4xKxCz5lszpvefTJmp3EAuIFFA+qWZ4LuiEWJcNVUIe9jBTa8j6m30BDr3q3RWpfRUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/8137a058e3e08723c19a069a11382d75/a0b58/argo7.webp 230w,\n/static/8137a058e3e08723c19a069a11382d75/bc10c/argo7.webp 460w,\n/static/8137a058e3e08723c19a069a11382d75/966d8/argo7.webp 920w,\n/static/8137a058e3e08723c19a069a11382d75/445df/argo7.webp 1380w,\n/static/8137a058e3e08723c19a069a11382d75/78de1/argo7.webp 1840w,\n/static/8137a058e3e08723c19a069a11382d75/cb61f/argo7.webp 1936w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/8137a058e3e08723c19a069a11382d75/81c8e/argo7.png 230w,\n/static/8137a058e3e08723c19a069a11382d75/08a84/argo7.png 460w,\n/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png 920w,\n/static/8137a058e3e08723c19a069a11382d75/b1001/argo7.png 1380w,\n/static/8137a058e3e08723c19a069a11382d75/161ec/argo7.png 1840w,\n/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png 1936w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png\" alt=\"argo7\" title=\"argo7\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Ok, we have specified a image that does not exist. Let us fix it in GitHub by changing <em>kustomization.yaml</em> as follows:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> mluukkai/dwk1</code></pre></div><p>When we sync the changes in ArgoCD, a new healthy pod is started and our app is up and running!</p><p>We can check the external IP either from command line with <em>kubectl</em> or clicking the service:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.391304347826086%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz4VQAW6DMAzk/3/bCyZ1WrcJOgYmiePESZzOQKm6ibanEyImd4ev6cF+D9D149fpR/kBAEgWCZx/ymZCOoE5fLbHrgcMYPHYD+9gB4vjMzZq0CN1xrXGTRQxsEEygT0nfX/MxvogIjml8w1yzsx/Jru4iCOzHqpCnyouhZljLrIc73EWFxGHWEpZR4qU82TsSEG2kLtiTR4ng97XumafU0qDw6h2Imqq7nUPFzF6ul1S78cYPQVK7ENw6FfT3Z1rXArbkmvOxTjkyHWw4mPdPu0nw/zbdN1Z2xoR41tbX17lcWHqoQ0l7bbWlbqkFl6Wtmdu83/8BQAWgkrmLrCcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/a0b58/argo8.webp 230w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/bc10c/argo8.webp 460w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/966d8/argo8.webp 920w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/445df/argo8.webp 1380w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/9d85b/argo8.webp 1720w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/81c8e/argo8.png 230w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/08a84/argo8.png 460w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png 920w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/b1001/argo8.png 1380w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png 1720w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png\" alt=\"argo8\" title=\"argo8\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Let us now change the sync mode to <em>automatic</em> by clicking the <em>Details</em> from the app page in ArgoCD.</p><p>Now all the configuration changes that we make to GitHub should be automatically applied by ArgoCD. Let us scale up the deployment to have 5 pods:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dwk1<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> dwk1<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">...</span></code></pre></div><p>After a small wait (the default sync frequency of ArgoCD is 180 seconds), app gets synchronized and 5 pods are up and running:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz3VQy1LDMAzM/38Xd2BCSYc8CKkfsSXLTuw2DWkblHJghgHNHjQrrbRSJrwbYlKjpxCO12W6XdZ1NccoY0jLPF8vN47178jmy/K5LCElcDSkNM0zs3E6KUQ/jmNMXF7/E/sxpdOUjpMGEpYkeOVC74K85xswSPSCefTaBY13bInP2h4PlgRQq7FWUCmopS2FqTVWEt65apww1NPYWfcmbdFjoWEnzd66rGGNhFLaagPwIEnepxRP5wP4RgHwNWxtOvPCN2FyR/sx5hZ3FLKH58IMXD6HdGIXtbCNBnZRCVseDLvoepZHvk6B38TWvVLIe9ix7X2rPnonrW+4uzMd+wRnKfjxyC4aCXwRq9Xd/CY2uEN6PGhOslY73vYNbm0VdMbxnziphflQyH+iEJXFzmAp7AtQ4YdH2efAN0v4BZ5SbbN+mHeF33wpIUcqwvCkTQ70BazU8IjWLkqtAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/7a969076cce54007f1e967c1b9c6a1d6/a0b58/argo9.webp 230w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/bc10c/argo9.webp 460w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/966d8/argo9.webp 920w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/445df/argo9.webp 1380w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/78de1/argo9.webp 1840w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/96199/argo9.webp 2764w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/7a969076cce54007f1e967c1b9c6a1d6/81c8e/argo9.png 230w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/08a84/argo9.png 460w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png 920w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/b1001/argo9.png 1380w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/161ec/argo9.png 1840w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png 2764w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png\" alt=\"argo9\" title=\"argo9\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Besides services, deployments and pods, the app configuration tree shows also some other objects. We see that there is a\n<a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/\" target=\"_blank\" rel=\"noopener noreferrer\">ReplicaSet</a> (in figure <em>rs</em>) in between deployment and the pods. A ReplicaSet is a Kubernetes object that ensures there is always a stable set of running pods for a specific workload. The ReplicaSet configuration defines a number of identical pods required, and if a pod is evicted or fails, creates more pods to compensate for the loss. Users do not usually define ReplicaSets directly, instead Deployments are used. A Deployment then creates a ReplicaSet that takes care of running the pod replicas.</p><p>The changes in app Kubernetes configurations that we make to GitHub are now nicely synched to the cluster. How about the changes in the app?</p><p>In order to deploy a new app version, we should change the image that is used in the deployment. Currently the image is defined in the file <em>kustomization.yaml</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> mluukkai/dwk1</code></pre></div><p>So to deploy a new the app, we should</p><ol>\n<li>create a new image with possibly a new tag</li>\n<li>change the kustomization.yaml to use the new image</li>\n<li>push changes to GitHub</li>\n</ol><p>Surely this could be done manually but that is not enough for us. Let us now define a GitHub Actions workflow that does all these steps.</p><p>The first step is already familiar to us from <a href=\"/part-3/2-deployment-pipeline\">part 3</a></p><p>The step 2 can be done with the command <em>kustomize edit</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">$ kustomize edit set image PROJECT/IMAGE=node<span class=\"token punctuation\">:</span><span class=\"token number\">20</span>\n$ cat kustomization.yaml\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> node\n  <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"20\"</span></code></pre></div><p>As we see, the command <em>changes</em> the file <em>kustomization.yaml</em>. So all that is left is to commit the file to the repository. Fortunately there is a ready made GitHub Action <a href=\"https://github.com/EndBug/add-and-commit\" target=\"_blank\" rel=\"noopener noreferrer\">add-and-commit</a> for that!</p><p>The workflow looks the following:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and publish application\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-publish</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build<span class=\"token punctuation\">,</span> Push<span class=\"token punctuation\">,</span> Release\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Hub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\"># tag image with the GitHub SHA to get a unique tag</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and publish backend\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n          docker build <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>tag \"mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\" .\n          docker push \"mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\"\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Kustomize\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> imranismail/setup<span class=\"token punctuation\">-</span>kustomize@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use right image\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> kustomize edit set image PROJECT/IMAGE=mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> commit kustomization.yaml to GitHub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> EndBug/add<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>commit@v9\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kustomization.yaml'</span>\n          <span class=\"token key atrule\">message</span><span class=\"token punctuation\">:</span> New version released $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div><p>There is still one more to do, from the repository settings we must give the GitHub Actions permission to write to our repository:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY042QaY6EIBSEvf/p5gC27QIogkALGmWdsk0m/pzKBym29ypUhAk2LWyUmPth6oaJTUrpbbWndf7JepstaLNzYU6lqgilFEvxMVLK2DhhYN73HSchRB+C9yEGD+BSvLz3JzarAoVYtI3GtXQkA2m7ruv7fhgmzhkdUYsQ1nPzHk1NlpqaF4XX27ZVJeekbf5pQi8brl51/W67pmkJZeazGvNR2rht348Qc7kCpgt46Nu5lK8vzjkEnmc5C8m5oGwcJw5Wa4/jOE9w5nzf/XuMdUKAjD5CiPlC4tOkXICQEiwK0lobjTzrepeoykN8luh1XV0UEEKiFpbYuP7soUfnO3nO1m0p5fJv/QLGgMjXxrD94AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/099030fe16625510838386413508f6e5/a0b58/gha-perm.webp 230w,\n/static/099030fe16625510838386413508f6e5/bc10c/gha-perm.webp 460w,\n/static/099030fe16625510838386413508f6e5/966d8/gha-perm.webp 920w,\n/static/099030fe16625510838386413508f6e5/445df/gha-perm.webp 1380w,\n/static/099030fe16625510838386413508f6e5/78de1/gha-perm.webp 1840w,\n/static/099030fe16625510838386413508f6e5/eb397/gha-perm.webp 1894w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/099030fe16625510838386413508f6e5/81c8e/gha-perm.png 230w,\n/static/099030fe16625510838386413508f6e5/08a84/gha-perm.png 460w,\n/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png 920w,\n/static/099030fe16625510838386413508f6e5/b1001/gha-perm.png 1380w,\n/static/099030fe16625510838386413508f6e5/161ec/gha-perm.png 1840w,\n/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png 1894w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png\" alt=\"gha perm\" title=\"gha perm\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>We are now set, all changes to configurations and to the app code are now deployed automatically by ArcoCD with the help of our GitHub Action workflow, so nice!</p><p>With GitOps we achieve the following:</p><ul>\n<li>\n<p>Better security</p>\n<ul>\n<li>Nobody needs access to the cluster, not even CI/CD services. No need to share access to the cluster with collaborators; they will commit changes like everyone else.</li>\n</ul>\n</li>\n<li>\n<p>Better transparency</p>\n<ul>\n<li>Everything is declared in the GitHub repository. When a new person joins the team they can check the repository; no need to pass ancient knowledge or hidden techniques as there are none.</li>\n</ul>\n</li>\n<li>\n<p>Better traceability</p>\n<ul>\n<li>All changes to the cluster are version-controlled. You will know exactly what was the state of the cluster and how it was changed and by whom.</li>\n</ul>\n</li>\n<li>\n<p>Risk reduction</p>\n<ul>\n<li>If something breaks simply revert the cluster to a working commit. <code class=\"language-text\">git revert</code> and the whole cluster is in a previous state.</li>\n</ul>\n</li>\n<li>\n<p>Portability</p>\n<ul>\n<li>Want to change to a new provider? Spin up a cluster and point it to the same repository - your cluster is now there.</li>\n</ul>\n</li>\n</ul><p>There are a few options for the GitOps setup. What we used here was having the configuration for the application in the same repository as the application itself. Another option is to have the configuration separate from the source code. That approach also removes the risk of having a pipeline loop where your pipeline commits to the repository which then triggers the pipeline...</p><exercise name='Exercise 4.07: GitOps the Project'><p>  Move The Project to use GitOps so that when you commit to the repository, the application is automatically updated.</p></exercise><p>The next one is still to be specified:</p><exercise name='Exercise 4.08: Moar GitOps'><p>eg:</p><p>  Move your cluster configuration to GitOps.</p><p>  Validate that everything works by deleting the cluster <code class=\"language-text\">k3d cluster delete</code> and recreating it by bootstrapping with ArcoCD.</p><p>or:</p><p>  prod and staging with overlays</p></exercise></div>","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"},"fileAbsolutePath":"/home/runner/work/kubernetes-hy.github.io/kubernetes-hy.github.io/data/part-4/3-GitOps.md"},"allPages":{"edges":[{"node":{"id":"e4e5fe1c-25b1-57b3-87eb-e204e767a49c","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"9f6e26aa-46a9-523d-96e4-a57c65ec083d","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"3d7eac33-2990-59d1-a002-64e0b0f4f370","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"ecaa7011-87db-5ece-9b3c-1cfad638324a","frontmatter":{"path":"/","title":"Homepage"}}},{"node":{"id":"57c61ed7-37c4-5d0f-acd8-1dca0de6be4a","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"8ecc11b1-3298-589e-b97a-2a3a36861b8d","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"dab4b6a7-96cf-5efe-83f4-f5199c283e65","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fb4fb717-329a-5d49-94c3-183aa16507e2","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"78948204-39a7-5f81-b9f4-3029400d5f82","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"fe4a80ee-85ba-536e-bbf5-c5695399f40f","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"19841be9-897c-577a-9f82-5a7381bc073c","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"9e4ff8d0-2e6c-5d55-83a0-16ada460096d","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"0b237cfb-5f2a-5d8e-9aa0-0cf9b045db3a","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"56f2a7a2-c9e2-5bbb-b6a7-76fd46592c69","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"f802a4ea-8d5a-503f-ad7b-d0138ab84c80","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"b810e0d9-0ac2-5073-a9dc-4ffd6649b7f7","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"40440141-c1a8-5723-858a-eea86119b5b6","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"708df9d2-30d1-518f-8066-80109a75c4dc","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"c8b1eb5e-3c98-59b3-b6e9-6173791d7e34","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"47a288aa-ece4-5ba6-ab6e-cbc63dbdc752","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"8a2e40fa-1703-5755-aa66-ac69bf2e291d","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"7bebb01b-c990-5e7e-a9aa-d60f10ba63dd","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"e4c53dca-867f-5293-9b28-657b695cd3f3","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"fd6ebeaa-c808-5f11-9bdc-30e4f69b8a2a","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"eae6660d-1d18-527a-bc1c-0f2f7ab54c6d","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"0353d158-f751-57fd-94ce-373924da1b05","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"9f3c6f02-668a-517b-b7b6-1828f74c7200","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"e80b74e8-a23b-5d3c-808b-833a72ac739c","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"78f84327-bd7b-5b5d-941d-9fae8bca88d3","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"0a2d8cfd-8e40-59a7-a688-e8bdc9fb9e3a","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"39fb03b7-2abe-515a-a543-b812fcbfdba5","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"a899eeb2-4329-5c9b-aadf-2fb803fa9142","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"471982cb-da12-5799-a6b2-fa8a3e67aa0d","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"cbd58376-8d52-5297-b38d-653179a1226f","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"f5314214-d779-5fb4-a19f-ab7442f3fbb2","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"33c86b5c-3684-5006-b4e7-dbd0c7cc04bc","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"da15a80e-5316-5986-afcf-75d521065017","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}